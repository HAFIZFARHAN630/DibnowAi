<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Sold Item</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

        <!-- Favicon -->
        <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">


    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Libraries Stylesheet -->

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">
</head>
<style>
.body-wrapper {
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

.footer {
    margin-top: auto;
    padding: 5px 0px 5px 50px;
    background-color: #dadae0;
    width: 109%;
    margin-left: -35px;
}
</style>
<body>
   

   <!-- Sidebar Start -->
   <div class="sidebar pe-4 pb-3">
    <nav class="navbar">
    
      <div class="d-flex align-items-center ms-4 mb-4">
        <a href="/Setting" class="d-flex align-items-center text-decoration-none">
            <div class="position-relative">
                <img class="rounded-circle" src="<%- profileImagePath %>" alt="Profile Image" style="width: 40px; height: 40px;" onerror="this.onerror=null; this.src='img/dumi img.png';">
                <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
            </div>
            <div class="ms-3">
                <h6 class="mb-0 text-dark"><%- firstName %></h6>
            </div>
        </a>
    </div>
        <div class="navbar-nav w-100">
          <a href="/index" class="nav-item nav-link"><i class="bi bi-tv"></i>Dashboard</a>
          <a href="/inventory" class="nav-item nav-link  "><i class="bi bi-clipboard-data"></i>Inventory</a>
          <a href="/repair" class="nav-item nav-link "><i class="bi bi-tools"></i>Repair</a>
          <a href="/in_stock" class="nav-item nav-link "><i class="bi bi-shop-window"></i>In Stock</a>
          <a href="/Clients" class="nav-item nav-link "><i class="bi bi-people"></i>Clients</a>
          <a href="/pricing" class="nav-item nav-link"><i class="bi bi-wallet2"></i>Plans</a>
          <a href="/sell" class="nav-item nav-link active"><i class="bi bi-cash-stack"></i>Sold Item</a>
          <a href="/Teams" class="nav-item nav-link"><i class="fa-solid fa-users"></i>Teams</a>
          <a href="/Help" class="nav-item nav-link"><i class="bi bi-chat-dots"></i>Help</a>
          </div>
    </nav>
</div>
<!-- Sidebar End -->
<%- include('../par/header.ejs') %>

<% if (success_msg.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong><i class="icon fa fa-check-circle me-2"></i><%= success_msg %></strong> 
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<% if (error_msg.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong><%= error_msg %></strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
 
<div class="body-wrapper" style="margin-top: 5rem !important;">
  <div class="container-fluid">
    <!-- Header Section -->
    <div class="card card-body py-3">
      <div class="row align-items-center">
        <div class="col-md-12">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-4 mb-sm-0 card-title">Sold Products</h4>
            <i class="bi bi-cash-stack" style="font-size:17px; padding-left:5px;"></i>
            <form class="position-relative ms-auto">
              <input type="text" id="searchInput" class="form-control search-chat py-2 ps-5" placeholder="Search Product">
              <i class="fa-solid fa-magnifying-glass position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="card card-body">
      <div class="table-responsive">
        <table class="table search-table align-middle text-nowrap" id="paginatedTable">
          <thead class="header-item text-center">
            <tr>
              <th>Full Name</th>
              <th>Product Name</th>
              <th>Number</th>
              <th>Price</th>
              <th>Type</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody class="text-center" id="productTableBody">
            <% products.forEach((product) => { %>
              <tr id="product-<%- product.id %>">
                <td><%- product.fullName %></td>
                <td><%- product.Product %></td>
                <td><%- product.Number %></td>
                <td> <%- product.Price %></td>
                <td><%- product.Type %></td>
                <td class="d-flex justify-content-center gap-2">
                  <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" 
                  data-bs-target="#confirmModal<%= product.id %>">Edit</button>               
                    <!-- Delete form -->
                    <form action="/sells/delete/<%- product.id %>" method="POST" style="display:inline;">
                      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>  
                </td>
              </tr>
            <% }); %>
          </tbody> 
        </table>
      </div>
    </div>
  </div>
</div>


<!--  -->
<% products.forEach((product) => { %>
  <div class="modal fade" id="confirmModal<%= product.id %>" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content gadget-form-modal" style="margin-top: -23px;">
        <div class="modal-header">
          <h3 class="modal-title text-dark" id="gadgetRepairModalLabel" style="margin-left: auto; font-size: xx-large;margin-bottom: -17px;">Return Product</h3>
          <button type="button" class="btn-close gadget-close-btn" data-bs-dismiss="modal" aria-label="Close">               
            <i class="fas fa-times gadget-close-btn" data-bs-dismiss="modal" aria-label="Close"></i>
          </button>
        </div>
        <div class="modal-body" style="padding-top: 17px;">
          <form action="/sells/update/<%= product.id %>" method="POST" class="gadget-form">
            <div class="row">
              <div class="col-md-6">
                <label for="fullName" class="form-label">Full Name</label>
                <input type="text" class="form-control gadget-input" name="fullName" value="<%= product.fullName %>" required>
              </div>
              <div class="col-md-6">
                <label for="Number" class="form-label">Mobile Number</label>
                <input type="number" class="form-control gadget-input" name="Number" value="<%= product.Number %>" required>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mt-n2">
                <label for="Price" class="form-label">Price</label>
                <input type="number" class="form-control gadget-input" name="Price" value="<%= product.Price %>" required>
              </div>
              <div class="col-md-6 mt-n2">
                <label for="Type" class="form-label">Type</label>
                <select class="form-select gadget-select" name="Type" required>
                  <option value="New" <%= product.Type === 'New' ? 'selected' : '' %>>New Product</option>
                  <option value="Used" <%= product.Type === 'Used' ? 'selected' : '' %>>Used Product</option>
                  <option value="Return" <%= product.Type === 'Return' ? 'selected' : '' %>>Return Product</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mt-n2">
                <label for="Product" class="form-label">Product Name</label>
                <input type="text" class="form-control gadget-input" name="Product" value="<%= product.Product %>" readonly required>
              </div>
            </div>
            <div class="modal-footer gap-3">
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-success">Confirm</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
<% }); %>


    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <span id="tableInfo" class="text-muted">Showing 1 to 10 of entries</span>
      <nav style="margin-right:31px;">
        <ul class="pagination" id="pagination"></ul>
      </nav>
    </div>
  </div>
</div>
</div>

  <!-- Footer -->
  <footer class="footer text-lg-start " >  
    <div class="p3 text-center">  
        Developed By <a style="color: black;" href="https://www.clicktaketech.com" target="_blank"><U>ClickTake Technologies</U></a> Copyright Â© 2025 DibNow || version 1.0.0

    </div>  
  </footer>

<script>
// search bar 
document.getElementById("searchInput").addEventListener("keyup", function() {
    const searchQuery = this.value.toLowerCase();
    const tableRows = document.querySelectorAll("#paginatedTable tbody tr");

    tableRows.forEach(row => {
      const fullName = row.querySelector("td:nth-child(1)").textContent.toLowerCase();
      const productName = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      
      if (fullName.includes(searchQuery) || productName.includes(searchQuery)) {
        row.style.display = ""; 
      } else {
        row.style.display = "none";  
      }
    });
  });

    // Table pagination // Table pagination
    document.addEventListener("DOMContentLoaded", () => {
    const table = document.getElementById("paginatedTable");
    const rows = table.querySelectorAll("tbody tr");
    const pagination = document.getElementById("pagination");
    const tableInfo = document.getElementById("tableInfo");
  
    const rowsPerPage = 10; // Number of rows to display per page
    const totalPages = Math.ceil(rows.length / rowsPerPage);
    let currentPage = 1;
  
    // Function to show rows for the current page
    const showPage = (page) => {
      currentPage = page;
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
  
      rows.forEach((row, index) => {
        row.style.display = index >= start && index < end ? "" : "none";
      });
  
      // Update the pagination info
      tableInfo.textContent = `Showing ${start + 1} to ${
        end > rows.length ? rows.length : end
      } of ${rows.length} entries`;
  
      // Update pagination buttons
      updatePagination();
    };
  
    // Function to create pagination buttons
    const updatePagination = () => {
      pagination.innerHTML = ""; 
  
      const createPageItem = (page, label, isDisabled = false, isActive = false) => {
        const li = document.createElement("li");
        li.className = `page-item ${isActive ? "active" : ""} ${isDisabled ? "disabled" : ""}`;
        li.innerHTML = `<a class="page-link" href="#">${label}</a>`;
        li.addEventListener("click", (e) => {
          e.preventDefault();
          if (!isDisabled) {
            if (label === "Previous") {
              showPage(currentPage - 1);
            } else if (label === "Next") {
              showPage(currentPage + 1);
            } else {
              showPage(page);
            }
          }
        });
        return li;
      };
  
      // Add "Previous" button
      pagination.appendChild(
        createPageItem(currentPage - 1, "Previous", currentPage === 1)
      );
  
      // Add numbered page buttons
      for (let i = 1; i <= totalPages; i++) {
        pagination.appendChild(
          createPageItem(i, i, false, i === currentPage)
        );
      }
  
      // Add "Next" button
      pagination.appendChild(
        createPageItem(currentPage + 1, "Next", currentPage === totalPages)
      );
    };
    // Initialize pagination
    showPage(1);
  });

</script>
</body>
 <!-- JavaScript Libraries -->
 <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Template Javascript -->
 <script src="js/main.js"></script>
</html>
