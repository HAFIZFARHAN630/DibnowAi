<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Dashboard</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link rel="icon" href="\images\Dib Now 16.svg" type="image/x-icon">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <!-- Tempus Dominus CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tempusdominus-bootstrap-4@5.39.0/build/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .patient-card {
      background-color: #FDE8D4;  /* Light peach color */
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .patient-card-header {
      background-color: #F57C00;  /* Orange header */
      color: white;
      padding: 10px;
      font-weight: bold;
      text-align: center;
    }
    .patient-card-body {
      padding: 20px;
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      color: #333;
    }
    #table-body tr {
  border-bottom: 0.5px solid #706868;
}



.card {
            background-color: #1e293b;
            border: none;
            border-radius: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 95%;
        }

        .chart-container canvas {
            max-height: 100% !important;
        }

        .progress-ring {
            width: 150px;
            height: 150px;
            margin: auto;
        }

        .progress-ring circle {
            fill: transparent;
            stroke-width: 10;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring .organic {
            stroke: #c084fc;
        }

        .progress-ring .social {
            stroke: #60a5fa;
        }

        .progress-ring .direct {
            stroke: #22d3ee;
        }

        .table-hover tbody tr:hover {
                          background-color: #2c3e50 !important; /* Darker color on hover */
                      }
                      .table tbody tr {
                          background-color: transparent !important; /* Transparent background for rows */
                      }
        .cont{
            display: flex !important;
            flex-direction: column !important;
        }

        /* Modern Plan & Subscription Cards */
        .modern-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .modern-card .card-header {
        background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%)!important;
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .modern-card .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .modern-card .header-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            position: relative;
            z-index: 1;
        }

        .modern-card .header-icon i {
            font-size: 1.5rem;
        }

        .modern-card .card-title {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .modern-card .card-body {
            padding: 30px;
        }

        /* Plan Overview Section */
        .plan-overview {
            margin-bottom: 25px;
        }

        .plan-main-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .plan-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }

        .plan-status-badge {
            position: relative;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-badge.active {
            background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important;
            color: white;
        }

        .status-badge.expired {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }

        .status-badge.pending {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }

        .status-badge.paid {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }

        .status-badge.unknown {
            background: linear-gradient(135deg, #a0aec0, #718096);
            color: white;
        }

        .plan-expiry {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 0.9rem;
        }

        .plan-expiry i {
            color: #667eea;
        }

        /* Plan Details Grid */
        .plan-details-grid {
            display: grid;
            gap: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-weight: 500;
        }

        .detail-label i {
            color: #667eea;
            width: 16px;
        }

        .detail-value {
            font-weight: 600;
            color: #1a202c;
        }

        .value-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .value-badge.success {
            background: #c6f6d5;
            color: #22543d;
        }

        .value-badge.danger {
            background: #fed7d7;
            color: #742a2a;
        }

        .value-badge.warning {
            background: #feebc8;
            color: #744210;
        }

        .value-badge.info {
            background: #bee3f8;
            color: #2a4365;
        }

        .value-badge.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .description {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 400;
        }

        /* No Plan State */
        .no-plan-state {
            text-align: center;
            padding: 40px 20px;
        }

        .no-plan-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .no-plan-icon i {
            font-size: 2rem;
            color: #e53e3e;
        }

        .no-plan-state h4 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .no-plan-state p {
            color: #64748b;
        }

        /* Subscription Status */
        .subscription-status {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .subscription-status .status-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .subscription-status .status-content h4 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .subscription-status .status-content p {
            margin: 0;
            color: #64748b;
        }

        .subscription-status.active-unpaid {
            background: linear-gradient(135deg, #fff5cd, #fde68a);
        }

        .subscription-status.active-unpaid .status-icon {
            background: #f59e0b;
        }

        .subscription-status.active-unpaid .status-icon i {
            color: white;
        }

        .subscription-status.active-unpaid .status-content h4 {
            color: #92400e;
        }

        .subscription-status.expired {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
        }

        .subscription-status.expired .status-icon {
            background: #ef4444;
        }

        .subscription-status.expired .status-icon i {
            color: white;
        }

        .subscription-status.expired .status-content h4 {
            color: #7f1d1d;
        }

        .subscription-status.active-valid {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        }

        .subscription-status.active-valid .status-icon {
            background: #10b981;
        }

        .subscription-status.active-valid .status-icon i {
            color: white;
        }

        .subscription-status.active-valid .status-content h4 {
            color: #065f46;
        }

        .subscription-status.pending {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }

        .subscription-status.pending .status-icon {
            background: #f59e0b;
        }

        .subscription-status.pending .status-icon i {
            color: white;
        }

        .subscription-status.pending .status-content h4 {
            color: #92400e;
        }

        /* No Subscription State */
        .no-subscription-state {
            text-align: center;
            padding: 40px 20px;
        }

        .no-subscription-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .no-subscription-icon i {
            font-size: 2rem;
            color: #6366f1;
        }

        .no-subscription-state h4 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .no-subscription-state p {
            color: #64748b;
        }

        .choose-plan-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 14px 32px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            margin-top: 20px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .choose-plan-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .choose-plan-btn:hover::before {
            left: 100%;
        }

        .choose-plan-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            color: white;
            text-decoration: none;
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Equal height cards - Enhanced */
        .cards-container {
            display: flex;
            gap: 20px;
            align-items: stretch;
            margin-bottom: 20px;
        }

        .plan-card-container,
        .subscription-card-container {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        .plan-card-container .modern-card,
        .subscription-card-container .modern-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .plan-card-container .modern-card .card-body,
        .subscription-card-container .modern-card .card-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* Ensure consistent card heights */
        .modern-card {
            min-height: 100%;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .modern-card .card-body {
                padding: 20px;
            }

            .cards-container {
                flex-direction: column;
                gap: 15px;
            }

            .plan-main-info {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .plan-name {
                font-size: 1.5rem;
            }

            .subscription-status {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .subscription-status .status-icon {
                width: 50px;
                height: 50px;
            }

            .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .detail-label {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
        <%- include('./par/sidebar.ejs') %>


        <!-- Navbar Start -->
        <%- include('./par/header.ejs') %>
        <!-- Navbar End -->




            <!-- Sale & Revenue Start -->
            <div class="container-fluid pt-4 px-4" style="background-color:#F3F3F9;">
                <a href="<%= isAdmin ? '/admin/all-stock' : '/in_stock' %>">
                <div class="row justify-content-center">
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                      <div class="patient-card position-relative" style="background-color: #E3F2FD;">
                        <div class="patient-card-header" style="background-color: #1E88E5;">Stock Products</div>
                        <div class="patient-card-body"><%= productCount %></div>
                        <i class="fa-solid fa-box position-absolute" style="font-size: 5rem; color: rgba(30, 136, 229, 0.2); bottom: 1px; right: 13px; z-index: 1;"></i>
                    </a> 
                    </div>
                    </div>
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <a href="<%= isAdmin ? '/admin/all-sales' : '/sell' %>">
                      <div class="patient-card position-relative" style="background-color: #F1F8E9;">
                        <div class="patient-card-header" style="background-color: #43A047;">Sales Products</div>
                        <div class="patient-card-body"><%= soldCount %></div>
                        <i class="bi bi-cart-fill position-absolute" style="font-size: 5rem; color: rgba(67, 160, 71, 0.2); bottom: -16px; right: 7px; z-index: 1;"></i>
                    </a>
                    </div>
                    </div>
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <a href="<%= isAdmin ? '/admin/all-repairs' : '/repair' %>">
                      <div class="patient-card position-relative" style="background-color: #FFF3E0;">
                        <div class="patient-card-header" style="background-color: #FB8C00;">Repair Products</div>
                        <div class="patient-card-body"><%= repairCount %></div>
                        <i class="bi bi-inboxes-fill position-absolute" style="font-size: 4.5rem; color: rgba(251, 140, 0, 0.2); bottom: -15px; right: 14px; z-index: 1;"></i>
                      </a>
                    </div>
                    </div>
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <a href="/userteam/list">
                      <div class="patient-card position-relative" style="background-color: #FCE4EC; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #D81B60; font-weight: bold;">Total team</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"><%= teamCount %></div>
                        <i class="bi bi-people-fill position-absolute" style="font-size: 6.5rem; color: rgba(216, 27, 96, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                        </a>
                    </div>
                    </div>
                  </div>
              </div>



        <!-- Updated Second Row -->
        <div class="container-fluid pt-4 px-4" style="background-color:#E8F5E9; padding-top: 0%;">
            <div class="row justify-content-center">
                <a href="<%= isAdmin ? '/admin/all-repairs?status=Booking' : '/inventory' %>">
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <div class="patient-card position-relative" style="background-color: #FFEBEE;">
                        <div class="patient-card-header text-white" style="background-color: #D32F2F;">Pending Orders</div>
                        <div class="patient-card-body"><%= pendingOrders %></div>
                        <i class="bi bi-clock-fill position-absolute" style="font-size: 4.5rem; color: rgba(211, 47, 47, 0.2); bottom: -13px; right: 12px; z-index: 1;"></i>
                        </a>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="<%= isAdmin ? '/admin/all-repairs?status=Completed' : '/repair' %>">
                    <div class="patient-card position-relative" style="background-color: #E0F2F1;">
                        <div class="patient-card-header text-white" style="background-color: #00796B;">Completed Repair Products</div>
                        <div class="patient-card-body"><%= completedRepairs %> </div>
                        <i class="bi bi-tools position-absolute" style="font-size: 4rem; color: rgba(0, 121, 107, 0.2); bottom: -8px; right: 13px; z-index: 1;"></i>
                        </a>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="<%= isAdmin ? '/admin/all-stock' : '/in_stock' %>">
                    <div class="patient-card position-relative" style="background-color: #FFF3E0;">
                        <div class="patient-card-header text-white" style="background-color: #3909d7ba;">Stock Total sales</div>
                        <div class="patient-card-body"> <%= totalSales ? totalSales : 0 %></div>
                        <i class="bi bi-bar-chart-fill position-absolute" style="font-size: 4.5rem; color: rgba(245, 124, 0, 0.2); bottom: -15px; right: 14px; z-index: 1;"></i>
                  </a>
                    </div>
                </div>
<% if (isUser) { %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/pricing"></a>
                    <div class="patient-card position-relative" style="background-color: #F3E5F5; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #7B1FA2; font-weight: bold;">Your Current Plan</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= plan_name %></div>
                        <i class="bi bi-layers-fill position-absolute" style="font-size: 6.5rem; color: rgba(123, 31, 162, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </div>
                </div>
                <% } %>

                <!-- User Count Cards - Admin Only -->
                <% if (isAdmin) { %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/admin">
                    <div class="patient-card position-relative" style="background-color: #E8F5E8; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #2E7D32; font-weight: bold;">All Users</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= totalUsers || 0 %></div>
                        <i class="bi bi-people-fill position-absolute" style="font-size: 6.5rem; color: rgba(46, 125, 50, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                        </a>
                    </div>
                </div>

                

                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/admin/active-users">
                    <div class="patient-card position-relative" style="background-color: #E3F2FD; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #1565C0; font-weight: bold;">Active Users</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= activeUsers || 0 %></div>
                        <i class="bi bi-person-check-fill position-absolute" style="font-size: 6.5rem; color: rgba(21, 101, 192, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                        </a>
                    </div>
                </div>
                
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/admin/expired-users">
                    <div class="patient-card position-relative" style="background-color: #FFEBEE; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #C62828; font-weight: bold;">Expired Users</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= expiredUsers || 0 %></div>
                        <i class="bi bi-person-x-fill position-absolute" style="font-size: 6.5rem; color: rgba(198, 40, 40, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                    </div>

                </div>
                
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/admin/active-users">
                    <div class="patient-card position-relative" style="background-color: #FFF3E0; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #F57C00; font-weight: bold;">Free Trial Users</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= freeTrialUsers || 0 %></div>
                        <i class="bi bi-gift-fill position-absolute" style="font-size: 6.5rem; color: rgba(245, 124, 0, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                </div>

            </div>

            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/UserComplaint">
                    <div class="patient-card position-relative" style="background-color: #E3F2FD; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #1976D2; font-weight: bold;">All Complaints</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= totalComplaints || 0 %></div>
                        <i class="bi bi-chat-left-text-fill position-absolute" style="font-size: 6.5rem; color: rgba(25, 118, 210, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                </div>

            </div>


            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/UserComplaint">
                    <div class="patient-card position-relative" style="background-color: #FFF3E0; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #FB8C00; font-weight: bold;">Pending Complaints</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= pendingComplaints || 0 %></div>
                        <i class="bi bi-clock-fill position-absolute" style="font-size: 6.5rem; color: rgba(251, 140, 0, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                </div>

            </div>


            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/UserComplaint">
                    <div class="patient-card position-relative" style="background-color: #E8F5E9; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #43A047; font-weight: bold;">Completed Complaints</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= completedComplaints || 0 %></div>
                        <i class="bi bi-check-circle-fill position-absolute" style="font-size: 6.5rem; color: rgba(67, 160, 71, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                </div>

            </div>

                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <a href="/admin/active -users">
                    <div class="patient-card position-relative" style="background-color: #E8F5E9; overflow: hidden; border-radius: 10px;">
                        <div class="patient-card-header text-white p-2" style="background-color: #388E3C; font-weight: bold;">Plan Bought Users</div>
                        <div class="patient-card-body p-4 position-relative" style="font-size: 2rem; font-weight: bold;"> <%= paidUsers || 0 %></div>
                        <i class="bi bi-cash-coin position-absolute" style="font-size: 6.5rem; color: rgba(56, 142, 60, 0.2); bottom: -36px; right: 10px; z-index: 1;"></i>
                    </a>
                </div>

                </div>


                <% } %>
                </div>
        </div>

        <!-- Enhanced Plan Status & Subscription Cards -->
        <% if (isUser) { %>
        <div class="container-fluid mt-4">
            <div class="cards-container">
                <!-- Plan Status Card -->
                <div class="plan-card-container">
                    <div class="plan-card modern-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-star-fill"></i>
                            </div>
                            <h5 class="card-title">Plan Status</h5>
                        </div>
                        <div class="card-body">
                            <% 
                            // Prioritize PlanRequest for status (has invoiceStatus field)
                            // Use Payments only if PlanRequest doesn't exist
                            const displayPlan = userPlan || latestPayment;
                            const hasActivePlan = displayPlan && (displayPlan.status === 'active' || displayPlan.status === 'Active');
                            %>
                            <% if (displayPlan && (displayPlan.planName || displayPlan.plan)) { %>
                                <% 
                                const planName = displayPlan.planName || displayPlan.plan;
                                const planStatus = displayPlan.status || 'Active';
                                const invoiceStatus = displayPlan.invoiceStatus || (hasActivePlan ? 'Paid' : 'Unpaid');
                                const planAmount = displayPlan.amount || 0;
                                const planStartDate = displayPlan.startDate || displayPlan.createdAt;
                                const planExpiryDate = displayPlan.expiryDate;
                                const planDescription = displayPlan.description || `${planName} subscription plan`;
                                %>
                                <div class="plan-overview">
                                    <div class="plan-main-info">
                                        <h3 class="plan-name"><%= planName %></h3>
                                        <div class="plan-status-badge">
                                            <% if (planStatus === 'Active' || planStatus === 'active') { %>
                                                <span class="status-badge active">
                                                    <i class="bi bi-check-circle-fill"></i>
                                                    Active
                                                </span>
                                            <% } else if (planStatus === 'Expired' || planStatus === 'expired') { %>
                                                <span class="status-badge expired">
                                                    <i class="bi bi-x-circle-fill"></i>
                                                    Expired
                                                </span>
                                            <% } else if (planStatus === 'Pending' || planStatus === 'pending') { %>
                                                <span class="status-badge pending">
                                                    <i class="bi bi-clock-fill"></i>
                                                    Pending
                                                </span>
                                            <% } else if (planStatus === 'Paid') { %>
                                                <span class="status-badge paid">
                                                    <i class="bi bi-check-circle-fill"></i>
                                                    Paid
                                                </span>
                                            <% } else { %>
                                                <span class="status-badge unknown">
                                                    <i class="bi bi-question-circle-fill"></i>
                                                    <%= planStatus %>
                                                </span>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="plan-expiry">
                                        <i class="bi bi-calendar-event"></i>
                                        <span>Expires: <%= planExpiryDate ? new Date(planExpiryDate).toLocaleDateString() : 'No expiry date' %></span>
                                    </div>
                                </div>

                                <!-- Plan Details Grid -->
                                <div class="plan-details-grid">
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-tag"></i>
                                            <span>Plan Name</span>
                                        </div>
                                        <div class="detail-value"><%= planName %></div>
                                    </div>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-activity"></i>
                                            <span>Status</span>
                                        </div>
                                        <div class="detail-value">
                                            <% if (planStatus === 'Active' || planStatus === 'active') { %>
                                                <span class="value-badge success">Active</span>
                                            <% } else if (planStatus === 'Expired' || planStatus === 'expired') { %>
                                                <span class="value-badge danger">Expired</span>
                                            <% } else if (planStatus === 'Pending' || planStatus === 'pending') { %>
                                                <span class="value-badge warning">Pending</span>
                                            <% } else if (planStatus === 'Paid') { %>
                                                <span class="value-badge info">Paid</span>
                                            <% } else { %>
                                                <span class="value-badge secondary"><%= planStatus %></span>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-receipt"></i>
                                            <span>Invoice Status</span>
                                        </div>
                                        <div class="detail-value">
                                            <% if (invoiceStatus === 'Paid' || invoiceStatus === 'paid') { %>
                                                <span class="value-badge success">Paid</span>
                                            <% } else { %>
                                                <span class="value-badge warning">Unpaid</span>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-calendar-plus"></i>
                                            <span>Start Date</span>
                                        </div>
                                        <div class="detail-value"><%= planStartDate ? new Date(planStartDate).toLocaleDateString() : 'N/A' %></div>
                                    </div>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-calendar-x"></i>
                                            <span>Expiry Date</span>
                                        </div>
                                        <div class="detail-value"><%= planExpiryDate ? new Date(planExpiryDate).toLocaleDateString() : 'No expiry date' %></div>
                                    </div>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-cash"></i>
                                            <span>Amount</span>
                                        </div>
                                        <div class="detail-value">£<%= planAmount %></div>
                                    </div>
                                    <% if (planDescription) { %>
                                    <div class="detail-row">
                                        <div class="detail-label">
                                            <i class="bi bi-info-circle"></i>
                                            <span>Description</span>
                                        </div>
                                        <div class="detail-value description"><%= planDescription %></div>
                                    </div>
                                    <% } %>
                                </div>
                            <% } else { %>
                                <div class="no-plan-state">
                                    <div class="no-plan-icon">
                                        <i class="bi bi-exclamation-triangle"></i>
                                    </div>
                                    <h4>No Plan Assigned</h4>
                                    <p>Contact your administrator for plan assignment</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Subscription Status Card -->
                <div class="subscription-card-container">
                    <div class="subscription-card modern-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-credit-card"></i>
                            </div>
                            <h5 class="card-title">Subscription Status</h5>
                        </div>
                        <div class="card-body">
                            <% 
                            // Use the same displayPlan logic from above
                            const subStatus = displayPlan ? (displayPlan.status || 'Active') : null;
                            const subInvoiceStatus = displayPlan ? (displayPlan.invoiceStatus || (hasActivePlan ? 'Paid' : 'Unpaid')) : null;
                            const subExpiryDate = displayPlan ? displayPlan.expiryDate : null;
                            const subPlanName = displayPlan ? (displayPlan.planName || displayPlan.plan) : null;
                            const isFreeTrial = subPlanName && (subPlanName === 'Free Trial' || subPlanName === 'FREE TRIAL');
                            const isOnlinePayment = hasActivePlan; // Online payments from Stripe/PayPal/PayFast
                            %>
                            <% if (displayPlan && (subStatus === 'Active' || subStatus === 'active')) { %>
                                <% if (subInvoiceStatus === 'Unpaid' || subInvoiceStatus === 'unpaid') { %>
                                    <% if (isFreeTrial) { %>
                                        <!-- Free Trial - Show as Active Trial -->
                                        <div class="subscription-status active-valid">
                                            <div class="status-icon">
                                                <i class="bi bi-gift"></i>
                                            </div>
                                            <div class="status-content">
                                                <h4>Free Trial Active</h4>
                                                <p>Expires: <%= subExpiryDate ? new Date(subExpiryDate).toLocaleDateString() : '7 days' %></p>
                                            </div>
                                            </div>
                                                                                         <a href="/pricing" class="choose-plan-btn" style="margin-top: 35px;">Upgrade to Premium</a>

                                        </div>
                                    <% } else { %>
                                        <!-- Paid plan but unpaid invoice (Manual Payment Only) -->
                                        <div class="subscription-status active-unpaid">
                                            <div class="status-icon">
                                                <i class="bi bi-exclamation-triangle"></i>
                                            </div>
                                            <div class="status-content">
                                                <h4>Payment Pending</h4>
                                                <p>Your payment is under admin review</p>
                                            </div>
                                        </div>
                                    <% } %>
                                <% } else if (subInvoiceStatus === 'Paid' || subInvoiceStatus === 'paid') { %>
                                    <% const now = new Date(); %>
                                    <% const expiryDate = subExpiryDate ? new Date(subExpiryDate) : null; %>
                                    <% if (expiryDate && now > expiryDate) { %>
                                        <div class="subscription-status expired">
                                            <div class="status-icon">
                                                <i class="bi bi-x-circle"></i>
                                            </div>
                                            <div class="status-content">
                                                <h4>Active + Paid + Expired</h4>
                                                <p>Your subscription has expired. Please renew.</p>
                                            </div>
                                        </div>
                                    <% } else { %>
                                        <div class="subscription-status active-valid">
                                            <div class="status-icon">
                                                <i class="bi bi-check-circle"></i>
                                            </div>
                                            <div class="status-content">
                                                <h4>Your plan is active! Enjoy the premium features!</h4>
                                                <p>Expires: <%= expiryDate ? expiryDate.toLocaleDateString() : 'No expiry' %></p>
                                            </div>
                                        </div>
                                        <!-- Upgrade Button -->
                                        <div class="mt-4">
                                            <a href="/pricing" class="btn btn-lg w-100" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); color: white; border: none; border-radius: 15px; padding: 15px 20px; font-size: 1.1rem; font-weight: 600; box-shadow: 0 8px 25px rgba(0, 51, 204, 0.3); transition: all 0.3s ease; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(0, 51, 204, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(0, 51, 204, 0.3)'">
                                                <i class="bi bi-rocket-takeoff" style="font-size: 1.3rem;"></i>
                                                Upgrade to Enjoy More Features
                                            </a>
                                        </div>
                                    <% } %>
                                <% } %>
                            <% } else if (displayPlan && (subStatus === 'Expired' || subStatus === 'expired')) { %>
                                <div class="subscription-status expired">
                                    <div class="status-icon">
                                        <i class="bi bi-x-circle"></i>
                                    </div>
                                    <div class="status-content">
                                        <h4>Subscription Expired</h4>
                                        <p>Your subscription has expired</p>
                                    </div>
                                </div>
                            <% } else if (displayPlan && (subStatus === 'Pending' || subStatus === 'pending')) { %>
                                <div class="subscription-status pending">
                                    <div class="status-icon">
                                        <i class="bi bi-clock"></i>
                                    </div>
                                    <div class="status-content">
                                        <h4>Payment Pending</h4>
                                        <p>Your payment is under review</p>
                                    </div>
                                </div>
                            <% } else { %>
                                <div class="no-subscription-state">
                                    <div class="no-subscription-icon">
                                        <i class="bi bi-credit-card"></i>
                                    </div>
                                    <h4>No Active Subscription</h4>
                                    <p><a href="/pricing" class="choose-plan-btn">Choose a Plan</a></p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        
        <% } %>



            <!-- Sale & Revenue End -->

            

            <style>
              .action-item:hover {
                transform: translateY(-5px);
                background: rgba(255, 255, 255, 0.25) !important;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
              }

              .action-item .action-icon i {
                transition: all 0.3s ease;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
              }

              .action-item:hover .action-icon i {
                transform: scale(1.1);
                filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
              }

              @media (max-width: 768px) {
                .actions-grid {
                  grid-template-columns: repeat(2, 1fr) !important;
                  gap: 10px;
                }

                .action-item {
                  padding: 15px 10px !important;
                }

                .action-icon i {
                  font-size: 1.5rem !important;
                }

                .action-label {
                  font-size: 0.8rem !important;
                }
              }
            </style>

            <!-- Sales & Profit Analysis Section -->
<div class="container-fluid p-4">
    <div class="row">
        <!-- Sales vs Profit Trend -->
        <div class="col-lg-8 col-md-7 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <h5 style="color: #1f2937; font-weight: 600; margin-bottom: 20px;"><i class="bi bi-graph-up me-2" style="color: #1E88E5;"></i>Total Sales & Profit from Sold Stock</h5>
                <div style="position: relative; height: 300px;">
                    <canvas id="salesProfitChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Profit Margin Card -->
        <div class="col-lg-4 col-md-5 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <div class="text-center mb-3">
                    <h5 style="color: #1f2937; font-weight: 600; margin: 0 0 10px 0;">Current Month Profit</h5>
                    <h3 style="color: #66BB6A; font-weight: 700; margin: 0;" id="currentMonthProfit">€0</h3>
                    <p style="color: #6b7280; font-size: 0.9rem; margin: 5px 0 0 0;">Profit Margin Analysis</p>
                </div>
                <div style="position: relative; height: 220px;">
                    <canvas id="profitPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>


          <!-- Sales Chart Start -->
          <div class="container-fluid p-4">
            <div class="row">
                <!-- Revenue Line Chart -->
                <div class="col-lg-8 col-md-7 mb-4">
                    <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 style="color: #1f2937; font-weight: 600; margin: 0;">Daily Revenue from Sold Stock Item</h5>
                            <h4 style="color: #1f2937; margin: 0;"><%= formattedTotalSales %> <span class="badge bg-success"><%= salesGrowth.toFixed(1) %>%</span></h4>
                        </div>
                        <div style="position: relative; height: 300px;">
                            <canvas id="revenueLineChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Sales Distribution Pie Chart -->
                <div class="col-lg-4 col-md-5 mb-4">
                    <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                        <div class="text-center mb-3">
                            <h5 style="color: #1f2937; font-weight: 600; margin: 0 0 10px 0;">Current Month Sales</h5>
                            <h3 style="color: #42A5F5; font-weight: 700; margin: 0;" id="currentMonthSales">€0</h3>
                            <p style="color: #6b7280; font-size: 0.9rem; margin: 5px 0 0 0;">Sales Distribution by Type</p>
                        </div>
                        <div style="position: relative; height: 220px;">
                            <canvas id="salesPieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Completed Tasks Section -->
<div class="container-fluid p-4">
    <div class="row">
        <div class="col-lg-8 col-md-7 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 style="color: #1f2937; font-weight: 600; margin: 0;"><i class="bi bi-clock me-2" style="color: #1E88E5;"></i>Monthly Completed Repairs Request</h5>
                </div>
                <h2 style="color: #1f2937;">257 <span style="color: #4caf50;">16.8% &#9650;</span></h2>
                <div style="position: relative; height: 300px;">
                    <canvas id="tasksChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Completed Repairs Summary Card -->
        <div class="col-lg-4 col-md-5 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <div class="text-center mb-3">
                    <h5 style="color: #1f2937; font-weight: 600; margin: 0 0 10px 0;">Total Completed</h5>
                    <h3 style="color: #66BB6A; font-weight: 700; margin: 0;" id="totalCompletedRepairs">0</h3>
                    <p style="color: #6b7280; font-size: 0.9rem; margin: 5px 0 0 0;">Monthly Completion Rate</p>
                </div>
                <div style="position: relative; height: 220px;">
                    <canvas id="completedRepairsPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Repair Revenue Section -->
<div class="container-fluid p-4">
    <div class="row">
        <div class="col-lg-8 col-md-7 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 style="color: #1f2937; font-weight: 600; margin: 0;"><i class="bi bi-cash-coin me-2" style="color: #42A5F5;"></i>Monthly Revenue from Repair Services</h5>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="repairRevenueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Repair Revenue Summary Card -->
        <div class="col-lg-4 col-md-5 mb-4">
            <div class="custom-card" style="background-color: #FFFFFF; border: 1px solid #e5e7eb; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); height: 100%;">
                <div class="text-center mb-3">
                    <h5 style="color: #1f2937; font-weight: 600; margin: 0 0 10px 0;">Current Month Repairs</h5>
                    <h3 style="color: #42A5F5; font-weight: 700; margin: 0;" id="currentMonthRepairRevenue">€0</h3>
                    <p style="color: #6b7280; font-size: 0.9rem; margin: 5px 0 0 0;">Repair Status Distribution</p>
                </div>
                <div style="position: relative; height: 220px;">
                    <canvas id="repairStatusPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>






<!-- Quick Actions Section -->
             <% if (isUser) { %>
            <div class="container-fluid px-4 py-3" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);; margin: 20px 0; border-radius: 15px; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);">
              <div class="quick-actions">
                <div class="d-flex align-items-center justify-content-center mb-4">
                  <i class="bi bi-lightning-charge-fill me-3" style="font-size: 1.5rem; color: #fff;"></i>
                  <h3 class="section-title mb-0 text-center" style="color: #fff; font-weight: 600; font-size: 1.4rem;">Quick Actions</h3>
                </div>
                <div class="actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                  <a href="/prayer" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-sun" style="font-size: 2rem; color: #FFE55C;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Prayer</p>
                  </a>

                  <a href="/quran" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-book" style="font-size: 2rem; color: #4ECDC4;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Quran</p>
                  </a>

                  <a href="/tasbeeh" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-circle-fill" style="font-size: 2rem; color: #45B7D1;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Tasbeeh</p>
                  </a>

                  <a href="/weather" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-cloud-sun" style="font-size: 2rem; color: #96CEB4;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Weather</p>
                  </a>

                  <a href="/pricing" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-box" style="font-size: 2rem; color: #FECA57;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Packages</p>
                  </a>

                  <a href="/History" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-clock-history" style="font-size: 2rem; color: #FF9FF3;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">History</p>
                  </a>

                  <a href="/contactUs" class="action-item" style="background: rgba(255, 255, 255, 0.15);  border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
                      <i class="bi bi-headset" style="font-size: 2rem; color: darkviolet;"></i>
                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Support</p>
                  </a>

                  <a href="/Setting" class="action-item" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 20px 15px; text-decoration: none; transition: all 0.3s ease; text-align: center;">
                    <div class="action-icon mb-2">
 <i class="bi bi-person-circle" style="font-size: 2rem; color: #5F27CD;"></i>                    </div>
                    <p class="action-label mb-0" style="color: #fff; font-weight: 800; font-size: 1rem;">Profile</p>
                  </a>
                </div>
              </div>
            </div>
            <% } %>


 


        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Initialize charts when DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM Content Loaded - Initializing charts...');

                // Daily Revenue Line Chart with Real Data
                let revenueChart;
                let globalSoldItems = [];
                async function initializeRevenueChart() {
                    try {
                        const ctxLineElement = document.getElementById('revenueLineChart');
                        if (!ctxLineElement) return;

                        // Fetch sold items data
                        const response = await fetch('/api/sold-items');
                        let soldItems = [];
                        if (response.ok) {
                            const data = await response.json();
                            soldItems = data.soldItems || [];
                            globalSoldItems = soldItems;
                        }

                        // Calculate this month's revenue
                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentYear = now.getFullYear();
                        const thisMonthRevenue = soldItems
                            .filter(item => {
                                const saleDate = new Date(item.sale_date);
                                return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
                            })
                            .reduce((sum, item) => sum + parseFloat(item.Price || 0), 0);

                        // Update Customer Type info text
                        const customerTypeInfo = document.getElementById('customerTypeInfo');
                        if (customerTypeInfo) {
                            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            customerTypeInfo.textContent = `Revenue generated in ${monthNames[currentMonth]} is €${thisMonthRevenue.toFixed(2)}`;
                        }

                        // Calculate total sales for Distribution info
                        const totalSales = soldItems.reduce((sum, item) => sum + parseFloat(item.Price || 0), 0);
                        const distributionInfo = document.getElementById('distributionInfo');
                        if (distributionInfo) {
                            distributionInfo.textContent = `Total sales this month: €${thisMonthRevenue.toFixed(2)} | All time: €${totalSales.toFixed(2)}`;
                        }

                        // Get last 7 days
                        const last7Days = [];
                        const dailyRevenue = [];
                        for (let i = 6; i >= 0; i--) {
                            const date = new Date();
                            date.setDate(date.getDate() - i);
                            last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                            
                            const dayRevenue = soldItems
                                .filter(item => {
                                    const saleDate = new Date(item.sale_date);
                                    return saleDate.toDateString() === date.toDateString();
                                })
                                .reduce((sum, item) => sum + parseFloat(item.Price || 0), 0);
                            
                            dailyRevenue.push(dayRevenue);
                        }

                        revenueChart = new Chart(ctxLineElement, {
                            type: 'line',
                            data: {
                                labels: last7Days,
                                datasets: [{
                                    label: 'Daily Revenue',
                                    data: dailyRevenue,
                                    borderColor: '#1E88E5',
                                    backgroundColor: 'rgba(30, 136, 229, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3,
                                    pointRadius: 4,
                                    pointHoverRadius: 6,
                                    pointBackgroundColor: '#1E88E5',
                                    pointBorderColor: '#FFFFFF',
                                    pointBorderWidth: 2
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: { intersect: false, mode: 'index' },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: '#6b7280',
                                            font: { size: 11, weight: '500' },
                                            callback: function(value) { return '€' + value.toFixed(0); }
                                        },
                                        grid: { color: 'rgba(0, 0, 0, 0.05)', drawBorder: false },
                                        border: { display: false }
                                    },
                                    x: {
                                        ticks: { color: '#6b7280', font: { size: 11, weight: '500' } },
                                        grid: { display: false },
                                        border: { display: false }
                                    }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) { return '€' + context.parsed.y.toFixed(2) + ' Revenue'; }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing revenue line chart:', error);
                    }
                }
                initializeRevenueChart();

                // Sales Distribution Pie Chart
                async function initializeSalesPieChart() {
                    try {
                        const ctxPieElement = document.getElementById('salesPieChart');
                        if (!ctxPieElement) return;

                        const response = await fetch('/api/sold-items');
                        let soldItems = [];
                        if (response.ok) {
                            const data = await response.json();
                            soldItems = data.soldItems || [];
                        }

                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentYear = now.getFullYear();

                        const currentMonthItems = soldItems.filter(item => {
                            const saleDate = new Date(item.sale_date);
                            return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
                        });

                        let retailSales = 0;
                        let wholesaleSales = 0;
                        let totalMonthSales = 0;

                        currentMonthItems.forEach(item => {
                            const price = parseFloat(item.Price || 0);
                            totalMonthSales += price;
                            if (item.Type === 'Retail') {
                                retailSales += price;
                            } else {
                                wholesaleSales += price;
                            }
                        });

                        document.getElementById('currentMonthSales').textContent = '€' + totalMonthSales.toFixed(2);

                        new Chart(ctxPieElement, {
                            type: 'doughnut',
                            data: {
                                labels: ['Retail Sales', 'Wholesale Sales'],
                                datasets: [{
                                    data: [retailSales, wholesaleSales],
                                    backgroundColor: ['#42A5F5', '#66BB6A'],
                                    borderWidth: 0,
                                    hoverOffset: 10
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            color: '#6b7280',
                                            font: { size: 12, weight: '500' },
                                            padding: 15,
                                            usePointStyle: true
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return label + ': €' + value.toFixed(2) + ' (' + percentage + '%)';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing sales pie chart:', error);
                    }
                }
                initializeSalesPieChart();

                // Profit Margin Pie Chart
                async function initializeProfitPieChart() {
                    try {
                        const ctxProfitPieElement = document.getElementById('profitPieChart');
                        if (!ctxProfitPieElement) return;

                        const response = await fetch('/api/sold-items');
                        let soldItems = [];
                        if (response.ok) {
                            const data = await response.json();
                            soldItems = data.soldItems || [];
                        }

                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentYear = now.getFullYear();

                        const currentMonthItems = soldItems.filter(item => {
                            const saleDate = new Date(item.sale_date);
                            return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
                        });

                        let totalProfit = 0;
                        let retailProfit = 0;
                        let wholesaleProfit = 0;

                        currentMonthItems.forEach(item => {
                            const salePrice = parseFloat(item.Price || 0);
                            const profit = item.Type === 'Retail' ? salePrice * 0.2 : salePrice * 0.3;
                            totalProfit += profit;
                            if (item.Type === 'Retail') {
                                retailProfit += profit;
                            } else {
                                wholesaleProfit += profit;
                            }
                        });

                        document.getElementById('currentMonthProfit').textContent = '€' + totalProfit.toFixed(2);

                        new Chart(ctxProfitPieElement, {
                            type: 'doughnut',
                            data: {
                                labels: ['Retail Profit', 'Wholesale Profit'],
                                datasets: [{
                                    data: [retailProfit, wholesaleProfit],
                                    backgroundColor: ['#66BB6A', '#FFA726'],
                                    borderWidth: 0,
                                    hoverOffset: 10
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            color: '#6b7280',
                                            font: { size: 12, weight: '500' },
                                            padding: 15,
                                            usePointStyle: true
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return label + ': €' + value.toFixed(2) + ' (' + percentage + '%)';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing profit pie chart:', error);
                    }
                }
                initializeProfitPieChart();

                // Sales vs Profit Dual Line Chart
                async function initializeSalesProfitChart() {
                    try {
                        const ctxSalesProfitElement = document.getElementById('salesProfitChart');
                        if (!ctxSalesProfitElement) return;

                        // Fetch sold items data
                        const response = await fetch('/api/sold-items');
                        let soldItems = [];
                        if (response.ok) {
                            const data = await response.json();
                            soldItems = data.soldItems || [];
                        }

                        // Calculate monthly sales and profit
                        const monthlySalesData = new Array(12).fill(0);
                        const monthlyProfitData = new Array(12).fill(0);
                        
                        soldItems.forEach(item => {
                            const saleDate = new Date(item.sale_date);
                            const month = saleDate.getMonth();
                            const salePrice = parseFloat(item.Price || 0);
                            const retailPrice = item.Type === 'Retail' ? salePrice * 0.8 : salePrice * 0.7;
                            
                            monthlySalesData[month] += salePrice;
                            monthlyProfitData[month] += (salePrice - retailPrice);
                        });

                        new Chart(ctxSalesProfitElement, {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [
                                    {
                                        label: 'Total Sales',
                                        data: monthlySalesData,
                                        borderColor: '#1E88E5',
                                        backgroundColor: 'rgba(30, 136, 229, 0.1)',
                                        tension: 0.4,
                                        fill: false,
                                        borderWidth: 3,
                                        pointRadius: 4,
                                        pointBackgroundColor: '#1E88E5',
                                        pointBorderColor: '#FFFFFF',
                                        pointBorderWidth: 2
                                    },
                                    {
                                        label: 'Total Profit',
                                        data: monthlyProfitData,
                                        borderColor: '#43A047',
                                        backgroundColor: 'rgba(67, 160, 71, 0.1)',
                                        tension: 0.4,
                                        fill: false,
                                        borderWidth: 3,
                                        pointRadius: 4,
                                        pointBackgroundColor: '#43A047',
                                        pointBorderColor: '#FFFFFF',
                                        pointBorderWidth: 2
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: { intersect: false, mode: 'index' },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: '#6b7280',
                                            font: { size: 11, weight: '500' },
                                            callback: function(value) { return '€' + value.toLocaleString(); }
                                        },
                                        grid: { color: 'rgba(0, 0, 0, 0.05)', drawBorder: false },
                                        border: { display: false }
                                    },
                                    x: {
                                        ticks: { color: '#6b7280', font: { size: 11, weight: '500' } },
                                        grid: { display: false },
                                        border: { display: false }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                        align: 'end',
                                        labels: {
                                            color: '#6b7280',
                                            font: { size: 12, weight: '500' },
                                            padding: 15,
                                            usePointStyle: true,
                                            pointStyle: 'circle'
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            title: function(context) {
                                                return context[0].label + ' 2025';
                                            },
                                            label: function(context) {
                                                return context.dataset.label + ': €' + context.parsed.y.toLocaleString();
                                            },
                                            afterBody: function(context) {
                                                if (context.length === 2) {
                                                    const sales = context[0].parsed.y;
                                                    const profit = context[1].parsed.y;
                                                    return 'Profit Margin: ' + ((profit / sales) * 100).toFixed(1) + '%';
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing sales profit chart:', error);
                    }
                }
                initializeSalesProfitChart();



                // Tasks Chart with Real Data (Monthly Repair Completions)
                let tasksChart;
                let chartData = {
                    completedCount: 0,
                    monthlyData: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    percentage: 0,
                    currentMonth: 0
                };

                // Function to fetch completed tasks data
                async function fetchCompletedTasksData() {
                    try {
                        const response = await fetch('/api/completed-tasks');
                        if (response.ok) {
                            const data = await response.json();
                            return data;
                        }
                    } catch (error) {
                        console.error('Error fetching completed tasks data:', error);
                    }
                    return null;
                }

                // Function to update tasks chart
                function updateTasksChart(data) {
                    if (!data) return;

                    chartData = data;
                    const totalRepairs = data.completedCount;
                    const repairCounts = data.monthlyData || [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

                    // Update the display with real repair data
                    const tasksDisplay = document.querySelector('#tasksChart').closest('.custom-card').querySelector('h2');
                    if (tasksDisplay) {
                        const percentage = data.percentage || 0;
                        const growthSymbol = percentage >= 0 ? '↗' : '↘';
                        const growthColor = percentage >= 0 ? '#4caf50' : '#f44336';
                        tasksDisplay.innerHTML = `${totalRepairs} <span style="color: ${growthColor};">${Math.abs(percentage)}% ${growthSymbol}</span>`;
                    }

                    // Update chart if it exists
                    if (tasksChart) {
                        const currentMonth = data.currentMonth || 0;
                        tasksChart.data.datasets[0].data = repairCounts;
                        tasksChart.data.datasets[0].pointRadius = repairCounts.map((_, i) => i === currentMonth ? 8 : 4);
                        tasksChart.data.datasets[0].pointBackgroundColor = repairCounts.map((_, i) => i === currentMonth ? '#4CAF50' : '#1E88E5');
                        tasksChart.data.datasets[0].pointBorderWidth = repairCounts.map((_, i) => i === currentMonth ? 3 : 2);
                        tasksChart.update();
                    }
                }

                // Function to initialize tasks chart
                async function initializeTasksChart() {
                    try {
                        console.log('Starting tasks chart initialization...');
                        const ctxTasksElement = document.getElementById('tasksChart');
                        console.log('Tasks chart element found:', !!ctxTasksElement);

                        if (!ctxTasksElement) {
                            console.error('Tasks chart canvas not found');
                            return;
                        }

                        const ctxTasks = ctxTasksElement.getContext('2d');

                        // Fetch initial data
                        const initialData = await fetchCompletedTasksData();
                        if (initialData) {
                            chartData = initialData;
                        }

                        const repairCounts = chartData.monthlyData || [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        const currentMonth = chartData.currentMonth || 0;

                        // Create point styles array - highlight current month
                        const pointRadii = repairCounts.map((_, index) => index === currentMonth ? 8 : 4);
                        const pointColors = repairCounts.map((_, index) => index === currentMonth ? '#4CAF50' : '#1E88E5');
                        const pointBorderWidths = repairCounts.map((_, index) => index === currentMonth ? 3 : 2);

                        tasksChart = new Chart(ctxTasks, {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [{
                                    label: 'Completed Repairs',
                                    data: repairCounts,
                                    borderColor: '#1E88E5',
                                    backgroundColor: 'rgba(30, 136, 229, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3,
                                    pointRadius: pointRadii,
                                    pointHoverRadius: 10,
                                    pointBackgroundColor: pointColors,
                                    pointBorderColor: '#FFFFFF',
                                    pointBorderWidth: pointBorderWidths,
                                    pointHoverBackgroundColor: '#FFFFFF',
                                    pointHoverBorderColor: pointColors,
                                    pointHoverBorderWidth: 3
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    intersect: false,
                                    mode: 'index'
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: '#6b7280',
                                            font: { size: 11, weight: '500' },
                                            stepSize: 20
                                        },
                                        grid: {
                                            color: 'rgba(0, 0, 0, 0.05)',
                                            drawBorder: false
                                        },
                                        border: { display: false }
                                    },
                                    x: {
                                        ticks: {
                                            color: '#6b7280',
                                            font: { size: 11, weight: '500' }
                                        },
                                        grid: { display: false },
                                        border: { display: false }
                                    }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#ffffff',
                                        bodyColor: '#ffffff',
                                        padding: 12,
                                        cornerRadius: 8,
                                        displayColors: false,
                                        callbacks: {
                                            title: function(context) {
                                                const monthLabel = context[0].label;
                                                const isCurrent = context[0].dataIndex === currentMonth;
                                                return monthLabel + ' 2025' + (isCurrent ? ' (Current Month)' : '');
                                            },
                                            label: function(context) {
                                                return context.parsed.y + ' Completed Repairs';
                                            }
                                        }
                                    },
                                    annotation: {
                                        annotations: {
                                            currentMonthLine: {
                                                type: 'line',
                                                xMin: currentMonth,
                                                xMax: currentMonth,
                                                borderColor: '#4CAF50',
                                                borderWidth: 2,
                                                borderDash: [5, 5],
                                                label: {
                                                    display: true,
                                                    content: 'Current',
                                                    position: 'start',
                                                    backgroundColor: '#4CAF50',
                                                    color: '#FFFFFF',
                                                    font: { size: 10, weight: 'bold' },
                                                    padding: 4,
                                                    borderRadius: 4
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Update chart with initial data
                        updateTasksChart(chartData);
                        console.log('Tasks chart created successfully');
                    } catch (error) {
                        console.error('Error initializing tasks chart:', error);
                    }
                }

                // Function to refresh chart data
                async function refreshTasksChart() {
                    const data = await fetchCompletedTasksData();
                    if (data) {
                        updateTasksChart(data);
                    }
                }

                // Make refresh function globally available for other pages
                window.refreshDashboardChart = refreshTasksChart;

                // Initialize chart
                initializeTasksChart();

                // Auto-refresh every 10 seconds
                setInterval(refreshTasksChart, 10000);

                // Completed Repairs Distribution Pie Chart
                async function initializeCompletedRepairsPieChart() {
                    try {
                        const ctxCompletedElement = document.getElementById('completedRepairsPieChart');
                        if (!ctxCompletedElement) return;

                        const response = await fetch('/api/completed-tasks');
                        let completedCount = 0;
                        let monthlyData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        if (response.ok) {
                            const data = await response.json();
                            completedCount = data.completedCount || 0;
                            monthlyData = data.monthlyData || monthlyData;
                        }

                        document.getElementById('totalCompletedRepairs').textContent = completedCount;

                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentMonthCompleted = monthlyData[currentMonth] || 0;
                        const previousMonthCompleted = currentMonth > 0 ? (monthlyData[currentMonth - 1] || 0) : 0;
                        const otherMonthsCompleted = completedCount - currentMonthCompleted - previousMonthCompleted;

                        new Chart(ctxCompletedElement, {
                            type: 'doughnut',
                            data: {
                                labels: ['Current Month', 'Previous Month', 'Other Months'],
                                datasets: [{
                                    data: [currentMonthCompleted, previousMonthCompleted, otherMonthsCompleted],
                                    backgroundColor: ['#66BB6A', '#42A5F5', '#FFA726'],
                                    borderWidth: 0,
                                    hoverOffset: 10
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            color: '#6b7280',
                                            font: { size: 12, weight: '500' },
                                            padding: 15,
                                            usePointStyle: true
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return label + ': ' + value + ' repairs (' + percentage + '%)';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing completed repairs pie chart:', error);
                    }
                }
                initializeCompletedRepairsPieChart();

                // Listen for repair status updates from other pages
                window.addEventListener('repairStatusUpdated', function(event) {
                    if (event.detail && event.detail.status === 'Completed') {
                        console.log('Repair status updated to Completed, refreshing charts...');
                        setTimeout(() => {
                            refreshTasksChart();
                            initializeCompletedRepairsPieChart();
                        }, 1000);
                    }
                });

                // Monthly Repair Revenue Chart
                async function initializeRepairRevenueChart() {
                    try {
                        const ctxRevenueElement = document.getElementById('repairRevenueChart');
                        if (!ctxRevenueElement) return;

                        const response = await fetch('/api/monthly-repair-revenue');
                        let monthlyRevenue = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        if (response.ok) {
                            const data = await response.json();
                            monthlyRevenue = data.monthlyRevenue || monthlyRevenue;
                        }

                        new Chart(ctxRevenueElement, {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [{
                                    label: 'Monthly Revenue',
                                    data: monthlyRevenue,
                                    borderColor: '#42A5F5',
                                    backgroundColor: 'rgba(66, 165, 245, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor: '#42A5F5',
                                    pointBorderColor: '#FFFFFF',
                                    pointBorderWidth: 2
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: { intersect: false, mode: 'index' },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: '#6b7280',
                                            font: { size: 11, weight: '500' },
                                            callback: function(value) { return '€' + value.toFixed(0); }
                                        },
                                        grid: { color: 'rgba(0, 0, 0, 0.05)', drawBorder: false },
                                        border: { display: false }
                                    },
                                    x: {
                                        ticks: { color: '#6b7280', font: { size: 11, weight: '500' } },
                                        grid: { display: false },
                                        border: { display: false }
                                    }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) { return '€' + context.parsed.y.toFixed(2) + ' Revenue'; }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing repair revenue chart:', error);
                    }
                }
                initializeRepairRevenueChart();

                // Repair Status Distribution Pie Chart
                async function initializeRepairStatusPieChart() {
                    try {
                        const ctxRepairStatusElement = document.getElementById('repairStatusPieChart');
                        if (!ctxRepairStatusElement) return;

                        const response = await fetch('/api/monthly-repair-revenue');
                        let monthlyRevenue = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        if (response.ok) {
                            const data = await response.json();
                            monthlyRevenue = data.monthlyRevenue || monthlyRevenue;
                        }

                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentMonthRevenue = monthlyRevenue[currentMonth] || 0;

                        document.getElementById('currentMonthRepairRevenue').textContent = '€' + currentMonthRevenue.toFixed(2);

                        // Fetch repair status counts for current month
                        const repairResponse = await fetch('/api/completed-tasks');
                        let completedCount = 0;
                        let monthlyData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        if (repairResponse.ok) {
                            const repairData = await repairResponse.json();
                            completedCount = repairData.completedCount || 0;
                            monthlyData = repairData.monthlyData || monthlyData;
                        }

                        const currentMonthCompleted = monthlyData[currentMonth] || 0;
                        const estimatedPending = Math.max(0, Math.floor(currentMonthCompleted * 0.3));
                        const estimatedProgress = Math.max(0, Math.floor(currentMonthCompleted * 0.2));

                        new Chart(ctxRepairStatusElement, {
                            type: 'doughnut',
                            data: {
                                labels: ['Completed', 'In Progress', 'Booking'],
                                datasets: [{
                                    data: [currentMonthCompleted, estimatedProgress, estimatedPending],
                                    backgroundColor: ['#66BB6A', '#FFA726', '#42A5F5'],
                                    borderWidth: 0,
                                    hoverOffset: 10
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            color: '#6b7280',
                                            font: { size: 12, weight: '500' },
                                            padding: 15,
                                            usePointStyle: true
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        cornerRadius: 8,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return label + ': ' + value + ' repairs (' + percentage + '%)';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing repair status pie chart:', error);
                    }
                }
                initializeRepairStatusPieChart();

                // Website Visitors Chart
                try {
                    console.log('Starting visitors chart initialization...');
                    const ctxVisitorsElement = document.getElementById('visitorsChart');
                    console.log('Visitors chart element found:', !!ctxVisitorsElement);

                    if (!ctxVisitorsElement) {
                        console.error('Visitors chart canvas not found');
                    } else {
                        const ctxVisitors = ctxVisitorsElement.getContext('2d');

                        const visitorsChart = new Chart(ctxVisitors, {
                            type: 'doughnut',
                            data: {
                                labels: ['Organic', 'Social', 'Direct'],
                                datasets: [{
                                    data: [80, 60, 50],
                                    backgroundColor: ['#4caf50', '#2196f3', '#00bcd4'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                }
                            }
                        });
                        console.log('Visitors chart created successfully');
                    }
                } catch (error) {
                    console.error('Error initializing visitors chart:', error);
                }

                console.log('All charts initialization completed');
            });
        </script>

            <!-- Sales Chart End -->


            <!-- Recent Sales Start -->


     <!-- Table Content -->
                    <div class="container-fluid p-4">
                        <div class="row justify-content-center">

                            <!-- Repair Queue Section -->
                            <div class="col-md-6 mb-4">
                                <div class="custom-card" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); border: none; border-radius: 20px; padding: 25px; height: 400px; overflow: auto; box-shadow: 0 10px 30px rgba(0, 51, 204, 0.3);">
                                    <div class="d-flex justify-content-between align-items-center mb-4 flex-s flex-wrap gap-2">
                                        <h4 class="mb-0 text-white" style="font-weight: 700; font-size: 1.5rem;"><i class="bi bi-tools me-2" style="color: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);"></i> Recently Booked Repairs </h4>
                                        <div class="d-flex align-items-center">
                                            <a href="/repair" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; padding: 8px 16px; font-weight: 600; transition: all 0.3s;"><i class="bi bi-tools"></i> See All Booked Repair</a>

                                        </div>
                                    </div>

                                    <div class="table-responsive hide-on-small" style="overflow: auto; width: 100%;">
                                        <table class="table table-hover mb-0" style="background-color: transparent;">
                                            <thead class="text-center hide-on-small">
                                                <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                                                    <th class="text-white" style="font-weight: 600; padding: 12px;">Full Name</th>
                                                    <th class="text-white" style="font-weight: 600; padding: 12px;">Product Name</th>
                                                    <th class="text-white" style="font-weight: 600; padding: 12px;">Price</th>
                                                    <th class="text-white" style="font-weight: 600; padding: 12px;">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody class="text-center">
                                                <% if (products && products.length > 0) { %>
                                                    <% products.slice(0, 6).forEach(product => { %>
                                                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">
                                                            <td class="text-white" style="padding: 12px; font-weight: 500;"><%= product.fullName %></td>
                                                            <td class="text-white" style="padding: 12px;"><%= product.brand %></td>
                                                            <td class="text-white" style="padding: 12px; font-weight: 600;"> <%= product.Price %></td>
                                                            <td style="padding: 12px;">
                                                                <button class="btn btn-sm text-white <%= product.status %>" style="border-radius: 20px; padding: 5px 15px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                                                                    <%= product.status %>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    <% }) %>
                                                <% } else { %>
                                                    <tr>
                                                        <td colspan="4" class="text-center text-white" style="padding: 30px;">No repair products found.</td>
                                                    </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>

                                        <!-- 1) Add this CSS (place in head or above the markup) -->
<style>
  /* Hide card list by default (desktop) */
  .product-cards { display: none; }

  /* On small screens hide the table and show cards */
  @media (max-width: 768px) {
    .product-cards { 
      display: flex !important; 
      flex-direction: column; 
      gap: 12px; 
      margin-top: 8px;
    }

    .product-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      color: #fff;
      width: 100%;
      box-sizing: border-box;
      word-break: break-word;
    }

    .product-card .card-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .product-card .card-col {
      display: flex;
      flex-direction: column;
      min-width: 0; /* allow text to wrap */
      margin-bottom: 4px;
    }

    .product-card .label {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 4px;
    }

    .product-card .value {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.2;
    }

    .product-card .status-wrap {
      margin-left: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .product-card .status-wrap .btn {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 6px;
      white-space: nowrap;
    }
  }

  /* Extra small screens: stack columns vertically */
  @media (max-width: 400px) {
    .product-card { padding: 10px; border-radius: 8px; }
    .product-card .card-row { flex-direction: column; align-items: flex-start; gap: 6px; }
    .product-card .status-wrap { align-self: stretch; width: 100%; display:flex; justify-content: flex-end; }
    .product-card .status-wrap .btn { width: auto; }
    .product-card .value { font-size: 13px; }
  }
  @media screen and (max-width:786px){
    .hide-on-small{
        display: none !important;
    }
  }
</style>

<!-- 2) Add this card markup RIGHT AFTER your existing table block (table remains unchanged) -->
<div class="product-cards">
  <% if (products && products.length > 0) { %>
    <% products.slice(0, 6).forEach(product => { %>
      <div class="product-card" aria-label="product-card-<%= product._id %>">
        <div class="card-row">
          <div class="card-col" style="flex:1;">
            <div class="label">Full Name</div>
            <div class="value"><%= product.fullName %></div>
          </div>

          <div class="card-col" style="flex:1;">
            <div class="label">Product Name</div>
            <div class="value"><%= product.brand %></div>
          </div>

          <div class="card-col" style="flex:0 0 auto; text-align:right;">
            <div class="label">Price</div>
            <div class="value"><%= product.Price %></div>
          </div>
        </div>

        <div class="card-row" style="margin-top:8px; align-items:center;">
          <div style="flex:1;">
            <!-- optional small note or id (remove if not needed) -->
            <div class="label" style="opacity:0.6;">Product ID</div>
            <div class="value" style="font-weight:400; font-size:12px;"><%= product._id %></div>
          </div>

          <div class="status-wrap">
            <!-- keep the original status button classes so your existing styles apply -->
            <button class="btn btn-sm text-white <%= product.status %>">
              <%= product.status %>
            </button>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <div class="product-card">
      <div class="card-row">
        <div class="card-col">
          <div class="label">No repair products found.</div>
        </div>
      </div>
    </div>
  <% } %>
</div>


                                </div>
                            </div>

                            <!-- Recent Sales Section -->
                          <div class="col-md-6 mb-4">
  <div class="custom-card" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); border: none; border-radius: 20px; padding: 25px; height: 400px; box-shadow: 0 10px 30px rgba(0, 51, 204, 0.3);">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
      <h4 class="mb-0 text-white" style="font-weight: 700; font-size: 1.5rem;"><i class="bi bi-box-seam me-2" style="color: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);"></i>Recently Added Stock</h4>
      <div class="d-flex align-items-center">
        <a href="/inventory" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; padding: 8px 16px; font-weight: 600; transition: all 0.3s;">
          <i class="bi bi-clipboard-data"></i> See All Added item
        </a>
      </div>
    </div>

    <!-- Scrollable table -->
    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
      <table class="table table-hover mb-0" style="background-color: transparent;">
        <thead  class="hide-on-small" style="position: sticky; top: 0; background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); z-index: 2;">
          <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
            <th class="text-white" style="font-weight: 600; padding: 12px;">Image</th>
            <th class="text-white" style="font-weight: 600; padding: 12px;">Product Name</th>
            <th class="text-white" style="font-weight: 600; padding: 12px;">Details</th>
            <th class="text-white" style="font-weight: 600; padding: 12px;">Sale Price</th>
            <th class="text-white" style="font-weight: 600; padding: 12px;">Retail Price</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <% if (inventory && inventory.length > 0) { %>
            <% inventory.slice(0, 5).forEach(product => { %>
              <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">
                <td style="padding: 12px;">
                  <img src="/uploads/<%= product.device_image %>" alt="Device"
                       style="width: 50px; height: 50px; object-fit: cover; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border: 2px solid rgba(255,255,255,0.3);">
                </td>
                <td class="text-white" style="padding: 12px; font-weight: 600;"><%= product.product_name %></td>
                <td class="text-white text-wrap" style="word-wrap: break-word; padding: 12px; font-size: 0.9rem;"><%= product.gadget_problem %></td>
                <td class="text-white" style="padding: 12px; font-weight: 600;"><%= product.Sale_Price %></td>
                <td class="text-white" style="padding: 12px; font-weight: 600;"><%= product.Retail_Price %></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="5" class="text-center text-white" style="padding: 30px;">No sales records found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>


                        </div>
                    </div>




<!-- Brands & Categories Section -->
<div class="container-fluid p-4">
    <div class="row justify-content-center">
        <!-- All Brands Section -->
        <div class="col-md-6 mb-4">
            <div class="custom-card" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); border: none; border-radius: 20px; padding: 25px; height: 400px; overflow: auto; box-shadow: 0 10px 30px rgba(0, 51, 204, 0.3);">
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
                    <h4 class="mb-0 text-white" style="font-weight: 700; font-size: 1.5rem;"><i class="bi bi-tag-fill me-2"></i>Recently Added Brands</h4>
                    <div class="d-flex align-items-center">
                        <a href="/AllBrand" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; padding: 8px 16px; font-weight: 600; transition: all 0.3s;"><i class="bi bi-tag"></i> See All Brands</a>
                    </div>
                </div>
                <div class="table-responsive hide-on-small" style="overflow: auto; width: 100%;">
                    <table class="table table-hover mb-0" style="background-color: transparent;">
                        <thead class="text-center hide-on-small">
                            <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                                <th class="text-white" style="font-weight: 600; padding: 12px;">Brand Name</th>
                                <th class="text-white" style="font-weight: 600; padding: 12px;">Description</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <% if (brands && brands.length > 0) { %>
                                <% brands.slice(0, 6).forEach(brand => { %>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">
                                        <td class="text-white" style="padding: 12px; font-weight: 600;"><%= brand.name %></td>
                                        <td class="text-white" style="padding: 12px;"><%= brand.description || 'N/A' %></td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="2" class="text-center text-white" style="padding: 30px;">No brands found.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <div class="product-cards">
                    <% if (brands && brands.length > 0) { %>
                        <% brands.slice(0, 6).forEach(brand => { %>
                            <div class="product-card">
                                <div class="card-row">
                                    <div class="card-col" style="flex:1;">
                                        <div class="label">Brand Name</div>
                                        <div class="value"><%= brand.name %></div>
                                    </div>
                                    <div class="card-col" style="flex:1;">
                                        <div class="label">Description</div>
                                        <div class="value"><%= brand.description || 'N/A' %></div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="product-card">
                            <div class="card-row">
                                <div class="card-col">
                                    <div class="label">No brands found.</div>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- All Categories Section -->
        <div class="col-md-6 mb-4">
            <div class="custom-card" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); border: none; border-radius: 20px; padding: 25px; height: 400px; overflow: auto; box-shadow: 0 10px 30px rgba(0, 51, 204, 0.3);">
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
                    <h4 class="mb-0 text-white" style="font-weight: 700; font-size: 1.5rem;"><i class="bi bi-grid-3x3-gap-fill me-2"></i>Recently Added Categories</h4>
                    <div class="d-flex align-items-center">
                        <a href="/Allcategories" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; padding: 8px 16px; font-weight: 600; transition: all 0.3s;"><i class="bi bi-grid"></i> See All Categories</a>
                    </div>
                </div>
                <div class="table-responsive hide-on-small" style="overflow: auto; width: 100%;">
                    <table class="table table-hover mb-0" style="background-color: transparent;">
                        <thead class="text-center hide-on-small">
                            <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                                <th class="text-white" style="font-weight: 600; padding: 12px;">Category Name</th>
                                <th class="text-white" style="font-weight: 600; padding: 12px;">Description</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <% if (categories && categories.length > 0) { %>
                                <% categories.slice(0, 6).forEach(category => { %>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">
                                        <td class="text-white" style="padding: 12px; font-weight: 600;"><%= category.name %></td>
                                        <td class="text-white" style="padding: 12px;"><%= category.description || 'N/A' %></td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="2" class="text-center text-white" style="padding: 30px;">No categories found.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <div class="product-cards">
                    <% if (categories && categories.length > 0) { %>
                        <% categories.slice(0, 6).forEach(category => { %>
                            <div class="product-card">
                                <div class="card-row">
                                    <div class="card-col" style="flex:1;">
                                        <div class="label">Category Name</div>
                                        <div class="value"><%= category.name %></div>
                                    </div>
                                    <div class="card-col" style="flex:1;">
                                        <div class="label">Description</div>
                                        <div class="value"><%= category.description || 'N/A' %></div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="product-card">
                            <div class="card-row">
                                <div class="card-col">
                                    <div class="label">No categories found.</div>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>



           <!-- Team Members Section -->
<div class="container-fluid p-4">
    <div class="row">
        <div class="col-12 mb-4">
            <div class="custom-card text-white" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); border: none; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 51, 204, 0.3);">
                <h5 class="mb-4 text-white" style="font-weight: 700; font-size: 1.1rem; text-align: center;">
                    <i class="bi bi-people-fill me-2"></i><%= isAdmin ? 'All Teams' : 'Recently Added Team Member' %>
                    <% if (teams && teams.length > 0) { %>
                        <span class="badge ms-2" style="background: rgba(255,255,255,0.25); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 600;"><%= teams.length %></span>
                    <% } %>
                </h5>
                <div class="row">
                <% if (teams && teams.length > 0) { %>
                    <% if (isAdmin) { %>
                        <!-- Admin: Show all team members -->
                        <% teams.slice(-8).reverse().forEach(team => { %>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="custom-product-item d-flex align-items-center p-3" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.25)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'">
                                <img src="<%= team.image ? '/uploads/' + team.image : 'https://img.icons8.com/3d-fluency/94/user-male--v4.png' %>" alt="<%= team.name %>" class="me-3" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);" onerror="this.src='https://img.icons8.com/3d-fluency/94/user-male--v4.png'"/>
                                <div>
                                    <strong style="color: white; font-size: 1rem;"><%= team.name %></strong>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    <% } else { %>
                        <!-- User: Show their own team members with plan limit consideration -->
                        <% teams.forEach(team => { %>
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="custom-product-item d-flex align-items-center p-3" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.25)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'">
                                <img src="<%= team.image ? '/uploads/' + team.image : 'https://img.icons8.com/3d-fluency/94/user-male--v4.png' %>" alt="<%= team.name %>" class="me-3" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);" onerror="this.src='https://img.icons8.com/3d-fluency/94/user-male--v4.png'"/>
                                <div>
                                    <strong style="color: white; font-size: 1rem;"><%= team.name %></strong>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                        <!-- Show plan limit message for free users if they have limited access -->
                        <% if ((plan_name === 'FREE TRIAL' || plan_name === 'Free Trial') && teamCount > 5) { %>
                        <div class="col-12">
                            <div class="alert mt-3 py-2" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 10px; color: white; font-size: 0.85rem;">
                                <i class="bi bi-info-circle me-1"></i>
                                Showing 5 of <%= teamCount %> team members. Upgrade for full access.
                            </div>
                        </div>
                        <% } %>
                    <% } %>
                <% } else { %>
                    <div class="col-12">
                        <p style="color: rgba(255,255,255,0.8); text-align: center; padding: 20px;">No team members added yet.</p>
                    </div>
                <% } %>
                </div>
            </div>
        </div>
    </div>
</div>



                   

      <!-- Recent Sales End -->
 <!-- footer -->
 <%- include('./par/footer.ejs') %>
  <!-- footer -->

</body>
  <!-- JavaScript Libraries -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tempusdominus-bootstrap-4@5.39.0/build/js/tempusdominus-bootstrap-4.min.js"></script>

  <!-- Template Javascript -->
  <script src="js/main.js"></script>

  <!-- Team Member Login Popup -->
  <% if (typeof isTeamMember !== 'undefined' && isTeamMember) { %>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Show popup notification
      const popup = document.createElement('div');
      popup.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); color: white; padding: 30px 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 51, 204, 0.4); z-index: 10000; text-align: center; min-width: 400px; animation: slideIn 0.3s ease-out;';
      
      popup.innerHTML = `
        <style>
          @keyframes slideIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
          }
          @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
          }
        </style>
        <div style="margin-bottom: 15px;">
          <i class="bi bi-person-check-fill" style="font-size: 3rem; color: #fff;"></i>
        </div>
        <h3 style="margin: 0 0 15px 0; font-weight: 700; color: #fff; font-size: 1.5rem;">Welcome to Dibnow Software Management</h3>
        <p style="margin: 0 0 8px 0; font-size: 1.1rem; color: rgba(255,255,255,0.95);"><strong><%= teamMemberName %></strong> (<%= teamMemberEmail %>)</p>
        <p style="margin: 0 0 15px 0; font-size: 1rem; color: rgba(255,255,255,0.9);">You are a team member of: <strong><%= firstName %> <%= lastName %></strong></p>
        <p style="margin: 0 0 20px 0; font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.5; padding: 0 10px;">You have limited access and can use the Dibnow system under your owner. Please follow instructions and do not modify owner settings.</p>
        <button onclick="this.parentElement.style.animation='fadeOut 0.3s'; setTimeout(() => { this.parentElement.remove(); document.querySelector('.team-backdrop').remove(); }, 300);" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 12px 35px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 1rem;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">Start Using Dibnow</button>
        <p style="margin-top: 15px; font-size: 0.8rem; color: rgba(255,255,255,0.7); padding: 0 10px;">
          <i class="bi bi-info-circle me-1"></i>Tip: All your actions are tracked and synced with your owner's system.
        </p>
      `;
      
      // Add backdrop
      const backdrop = document.createElement('div');
      backdrop.className = 'team-backdrop';
      backdrop.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(5px);';
      backdrop.onclick = function() {
        popup.style.animation = 'fadeOut 0.3s';
        backdrop.style.animation = 'fadeOut 0.3s';
        setTimeout(() => {
          popup.remove();
          backdrop.remove();
        }, 300);
      };
      
      document.body.appendChild(backdrop);
      document.body.appendChild(popup);
      
      // Auto close after 10 seconds
      setTimeout(() => {
        if (popup.parentElement) {
          popup.style.animation = 'fadeOut 0.3s';
          backdrop.style.animation = 'fadeOut 0.3s';
          setTimeout(() => {
            popup.remove();
            backdrop.remove();
          }, 300);
        }
      }, 10000);
    });
  </script>
  <% } %>
</html>