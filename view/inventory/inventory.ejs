<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Inventory</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

        <!-- Favicon -->
            <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">


    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Libraries Stylesheet -->

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">
</head>
<style>
.body-wrapper {
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

.footer {
    margin-top: auto;
    padding: 5px 80px 5px 30px;
    background-color: #dadae0;
    text-align: center;
    width: 109%;
    margin-left: -35px;
      }
</style>
<body>
   
  <!--  -->
<%- include('../par/Add_Repair.ejs') %>
<!--  -->

   <%- include('../par/sidebar.ejs') %>

      <!-- Navbar start -->
      <%- include('../par/header.ejs') %>
 
      
  <div class="action-buttons" style="display:flex; justify-content: end; margin-top: 10px; gap: 5px; margin-right: 23px;">
    <button class="btn btn-action btn-primary" data-bs-toggle="modal" data-bs-target="#gadgetrModal"><i class="bi bi-clipboard-data"></i> Add Inventory</button>
    <button class="btn btn-action btn-success" data-bs-toggle="modal" data-bs-target="#categoriesModal"><i class="bi bi-tags"></i> Add Category</button>                    
    <button class="btn btn-action btn-info" data-bs-toggle="modal" data-bs-target="#brandModal"><i class="bi bi-box"></i>  Add Brand   </button>    
    <button class="btn btn-action btn-danger" data-bs-toggle="modal" data-bs-target="#gadgetRepairModal"><i class="bi bi-tools"></i> Add Repair Customer </button>                  
  </div>
      <!-- Navbar End -->

      <!-- Widget Start -->   
        <div class="container-fluid pt-4 px-4">
            <div class="row g-4">
              <div class="col-12 col-md-12">
                <div class="h-100 p-4" style="border-radius: 15px; background-color: #fff; max-width: 100%; width: 100%;">
                  <h6 class="text-dark mb-3">Monthly Earnings</h6>
                  <div style="position: relative; height: 300px;">
                    <canvas id="earningsChart"></canvas>
                  </div>
                </div>
              </div>
  <!-- Script for Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    
    const soldItems = <%- JSON.stringify(solditems) %>;
    const daysInMonth = <%- JSON.stringify(daysInMonth) %>;
  
    console.log("Sold Items:", soldItems);
    console.log("Days in Month:", daysInMonth);
  
    // Ensure valid data
    if (!soldItems || !daysInMonth) {
      console.error("Data missing for chart rendering.");
    }
  
    const totalSalesData = [];
    const totalProfitData = [];
    const dailyData = {};
  
    // Initialize daily data
    daysInMonth.forEach((day) => {
      dailyData[day] = { sales: 0, profit: 0 };
    });
  
    // Populate daily totals
    soldItems.forEach((item) => {
      const saleDate = new Date(item.sale_date).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
      });
      const salePrice = parseFloat(item.Price);
      const profit = salePrice - (item.Type === "Retail" ? salePrice * 0.8 : salePrice * 0.7);
  
      if (dailyData[saleDate]) {
        dailyData[saleDate].sales += salePrice;
        dailyData[saleDate].profit += profit;
      }
    });
  
    // Prepare chart data
    daysInMonth.forEach((day) => {
      totalSalesData.push(dailyData[day].sales);
      totalProfitData.push(dailyData[day].profit);
    });
  
    // Create gradient
    function createGradient(ctx, colorStart, colorEnd) {
      const gradient = ctx.createLinearGradient(0, 0, 0, 300);
      gradient.addColorStop(0, colorStart);
      gradient.addColorStop(1, colorEnd);
      return gradient;
    }
  
    const ctx = document.getElementById("earningsChart").getContext("2d");
    console.log("Canvas Context:", ctx);
  
    const gradientRed = createGradient(ctx, "rgba(255, 0, 0, 0.8)", "rgba(255, 0, 0, 0)");
    const gradientBlue = createGradient(ctx, "rgba(0, 176, 255, 0.8)", "rgba(0, 176, 255, 0)");
  
    const chartData = {
      labels: daysInMonth,
      datasets: [
        {
          label: "Total Sales",
          data: totalSalesData,
          borderColor: "rgba(255, 0, 0, 1)",
          backgroundColor: gradientRed,
          pointBackgroundColor: "#fff",
          pointBorderColor: "#ff0000",
          pointRadius: 5,
          fill: true,
          tension: 0.5,
        },
        {
          label: "Total Profit",
          data: totalProfitData,
          borderColor: "rgba(0, 176, 255, 1)",
          backgroundColor: gradientBlue,
          pointBackgroundColor: "#fff",
          pointBorderColor: "#00b0ff",
          pointRadius: 5,
          fill: true,
          tension: 0.4,
        },
      ],
    };
  
    new Chart(ctx, {
      type: "line",
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: "Daily Total Sales and Profit",
            font: {
              size: 20,
            },
          },
          legend: {
            labels: {
              color: "#333",
              font: {
                size: 14,
              },
            },
          },
        },
        scales: {
          x: {
            ticks: {
              color: "#333",
              maxTicksLimit: 10,
            },
            grid: {
              color: "rgba(0, 0, 0, 0.1)",
            },
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: "#333",
            },
            grid: {
              color: "rgba(0, 0, 0, 0.1)",
            },
          },
        },
      },
    });
  </script>
    
      <div class="body-wrapper" style="margin-top: 8rem !important;">
        <div class="container-fluid">
          <div class="card card-body py-3">
            <div class="row align-items-center">
              <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center">
                  <h4 class="mb-4 mb-sm-0 card-title">Inventory</h4>
                  <i class="bi bi-clipboard-data"style="font-size:17px;padding-left:5px;"></i>
                      <form class="position-relative ms-auto">
                    <input type="text" id="searchInput" class="form-control search-chat py-2 ps-5" placeholder="Search Product">
                    <i class="fa-solid fa-magnifying-glass position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
                  </form>
                </div>
              </div>
            </div>
          </div>
      
          <div class="card card-body">
            <div class="table-responsive">
              <table class="table search-table align-middle text-nowrap" id="paginatedTable">
                <thead class="header-item text-center">
                  <tr>
                    <th>Image</th>
                    <th>Product Name</th>
                    <th>Details</th>
                    <th>Sale Price</th>
                    <th>Retail Price</th>
                  </tr>
                </thead>
                <tbody id="table-body" class="text-center">
                  <% if (typeof products !== 'undefined' && Array.isArray(products) && products.length > 0) { %>
                    <% products.forEach(product => { %>
      
                      <tr class="search-items" data-user-id="<%= product.id %>">
                        <td>
                          <span class="user-name mb-0 text-dark">
                            <img src="/uploads/<%= product.device_image %>" alt="Device Icon" style="width: 30px; height: 30px; object-fit: cover">
                          </span>
                        </td>
                        <td>
                          <span class="usr-location text-dark"><%= product.product_name %></span>
                        </td>
                        <td>
                          <span class="usr-location text-dark text-wrap" style="word-wrap: break-word; white-space: normal;">
                            <%= product.gadget_problem %>
                          </span>
                        </td>
                        <td>
                          <span class="usr-location text-dark"> <%= product.Sale_Price %></span>
                        </td>
                        <td>
                          <span class="usr-location text-dark"> <%= product.Retail_Price %></span>
                        </td>
                      </tr>
      
                    <% }) %>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
            <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <span id="tableInfo" class="text-muted">Showing 1 to 10 of <%= products.length %> entries</span>
              <nav style="margin-right:31px;">
                <ul class="pagination" id="pagination"></ul>
              </nav>
            </div>
          </div>
<!-- footer -->
          <footer class="footer  text-lg-start ">  
            <div class="p3 text-center">  
              Developed By <a style="color: black;" href="https://www.clicktaketech.com" target="_blank"><U>ClickTake Technologies</U></a> Copyright Â© 2025 DibNow || version 1.0.0
            </div>    
          </footer>
          <!-- footer -->
</body>
<script>
  // Table pagination // Table pagination
document.addEventListener("DOMContentLoaded", () => {
  const table = document.getElementById("paginatedTable");
  const rows = table.querySelectorAll("tbody tr");
  const pagination = document.getElementById("pagination");
  const tableInfo = document.getElementById("tableInfo");

  const rowsPerPage = 10;
  const totalPages = Math.ceil(rows.length / rowsPerPage);
  let currentPage = 1;

  const showPage = (page) => {
    currentPage = page;
    const start = (page - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    rows.forEach((row, index) => {
      row.style.display = index >= start && index < end ? "" : "none";
    });

    tableInfo.textContent = `Showing ${start + 1} to ${
      end > rows.length ? rows.length : end
    } of ${rows.length} entries`;

    updatePagination();
  };

  const updatePagination = () => {
    pagination.innerHTML = ""; 

    const createPageItem = (page, label, isDisabled = false, isActive = false) => {
      const li = document.createElement("li");
      li.className = `page-item ${isActive ? "active" : ""} ${isDisabled ? "disabled" : ""}`;
      li.innerHTML = `<a class="page-link" href="#">${label}</a>`;
      li.addEventListener("click", (e) => {
        e.preventDefault();
        if (!isDisabled) {
          if (label === "Previous") {
            showPage(currentPage - 1);
          } else if (label === "Next") {
            showPage(currentPage + 1);
          } else {
            showPage(page);
          }
        }
      });
      return li;
    };

    pagination.appendChild(
      createPageItem(currentPage - 1, "Previous", currentPage === 1)
    );

    for (let i = 1; i <= totalPages; i++) {
      pagination.appendChild(
        createPageItem(i, i, false, i === currentPage)
      );
    }

    pagination.appendChild(
      createPageItem(currentPage + 1, "Next", currentPage === totalPages)
    );
  };

  showPage(1);
});
// search
const searchInput = document.getElementById("searchInput");
const tableBody = document.getElementById("table-body");

searchInput.addEventListener("input", () => {
  const query = searchInput.value.toLowerCase();

  const rows = tableBody.querySelectorAll("tr");
  rows.forEach((row) => {
    const userName = row.querySelector(".user-name").textContent.toLowerCase();
    const location = row.querySelector(".usr-location").textContent.toLowerCase();

    if (userName.includes(query) || location.includes(query)) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
});

</script>
 <!-- JavaScript Libraries -->
 <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Template Javascript -->
 <script src="js/main.js"></script>
</html>
