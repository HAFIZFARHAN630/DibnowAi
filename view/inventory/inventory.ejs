<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Inventory</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

        <!-- Favicon -->
            <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">


    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Libraries Stylesheet -->

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">
</head>
<style>
.body-wrapper {
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

.footer {
    margin-top: auto;
    padding: 5px 80px 5px 30px;
    background-color: #dadae0;
    text-align: center;
    width: 109%;
    margin-left: -35px;
      }

/* Enhanced Table Design - Same as adminfile.ejs */
.table {
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: none;
}

.table thead th {
  background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border: none !important;
  padding: 20px 15px;
  font-size: 14px;
}

.table tbody tr {
  transition: all 0.3s ease;
  border: none !important;
}

.table tbody tr:hover {
  background-color: #f8f9ff;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.table tbody td {
  padding: 18px 15px;
  border: none !important;
  border-bottom: 1px solid #f0f0f0;
  vertical-align: middle;
}

.table tbody tr.search-hidden {
  display: none;
}

.no-results {
  text-align: center;
  padding: 40px;
  color: #6b7280;
}

.no-results i {
  font-size: 48px;
  margin-bottom: 15px;
  opacity: 0.5;
}
 .action-buttons-b{
        display: flex;
        align-items: center;
        margin-top: 20px;
        gap: 15px;
        justify-content: flex-end;
    
      }
      @media screen and (max-width: 768px) {
        .action-buttons-b {
          flex-wrap: wrap;
          /* flex-direction: column; */
          gap: 10px;
        }
        .action-buttons-b button{
          width: fit-content !important;
        }
      }
      /* Reduce default container spacing */
.container-fluid {
  padding-left: 5px !important;
  padding-right: 5px !important;
}

/* Card adjustments */
.card {
  border-radius: 10px;
  /* padding: 10px !important; */
}

/* Fix cards on very small screens */
@media (max-width: 400px) {
  .card {
    margin-left: 0;
    margin-right: 0;
  }
  .card-body {
    padding: 5px !important;
  }
  .card-body img {
    width: 35px !important;
    height: 35px !important;
  }
  .card-body h6 {
    font-size: 14px;
  }
  .card-body p {
    font-size: 13px;
    margin-bottom: 8px;
  }
  .card-body .fw-bold {
    font-size: 13px;
  }
}
.body-wrapper{
  max-width: 100vw !important;
  overflow-x: hidden !important;
}

/* Professional Pagination Buttons */
.pagination .page-link {
  background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important;
  color: white !important;
  border: none !important;
  font-weight: 600 !important;
  padding: 10px 24px !important;
  min-width: 120px !important;
  border-radius: 8px !important;
  transition: all 0.3s ease !important;
  box-shadow: 0 2px 8px rgba(0, 51, 204, 0.3) !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
}

.pagination .page-link:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(0, 51, 204, 0.4) !important;
}

.pagination .page-item.disabled .page-link {
  background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

.pagination .page-item {
  margin: 0 4px !important;
}

</style>
<body style="max-width: 100vw !important; overflow-x: hidden !important;">
   
  <!--  -->
<%- include('../par/Add_Repair.ejs') %>
<!--  -->

   <%- include('../par/sidebar.ejs') %>

      <!-- Navbar start -->
      <%- include('../par/header.ejs') %>
 
      
  <div class="action-buttons-b">
    <button class="btn btn-action btn-primary" data-bs-toggle="modal" data-bs-target="#gadgetrModal"><i class="bi bi-clipboard-data"></i> Add Inventory</button>
    <button class="btn btn-action btn-success" data-bs-toggle="modal" data-bs-target="#categoriesModal"><i class="bi bi-tags"></i> Add Category</button>                    
    <button class="btn btn-action btn-info" data-bs-toggle="modal" data-bs-target="#brandModal"><i class="bi bi-box"></i>  Add Brand   </button>    
    <button class="btn btn-action btn-danger" data-bs-toggle="modal" data-bs-target="#gadgetRepairModal"><i class="bi bi-tools"></i> Add Repair Customer </button>                  
  </div>
      <!-- Navbar End -->

      <!-- Widget Start -->   
        <div class="container-fluid pt-4 px-4">
            <div class="row g-4">
              <div class="col-12 col-md-12">
                <div class="h-100 p-4" style="border-radius: 15px; background-color: #fff; max-width: 100%; width: 100%;">
                  <h6 class="text-dark mb-3">Monthly Earnings</h6>
                  <div style="position: relative; height: 300px;">
                    <canvas id="earningsChart"></canvas>
                  </div>
                </div>
              </div>
  <!-- Script for Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    
    const soldItems = <%- JSON.stringify(solditems) %>;
    const daysInMonth = <%- JSON.stringify(daysInMonth) %>;
  
    console.log("Sold Items:", soldItems);
    console.log("Days in Month:", daysInMonth);
  
    // Ensure valid data
    if (!soldItems || !daysInMonth) {
      console.error("Data missing for chart rendering.");
    }
  
    const totalSalesData = [];
    const totalProfitData = [];
    const dailyData = {};
  
    // Initialize daily data
    daysInMonth.forEach((day) => {
      dailyData[day] = { sales: 0, profit: 0 };
    });
  
    // Populate daily totals
    soldItems.forEach((item) => {
      const saleDate = new Date(item.sale_date).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
      });
      const salePrice = parseFloat(item.Price);
      const profit = salePrice - (item.Type === "Retail" ? salePrice * 0.8 : salePrice * 0.7);
  
      if (dailyData[saleDate]) {
        dailyData[saleDate].sales += salePrice;
        dailyData[saleDate].profit += profit;
      }
    });
  
    // Prepare chart data
    daysInMonth.forEach((day) => {
      totalSalesData.push(dailyData[day].sales);
      totalProfitData.push(dailyData[day].profit);
    });
  
    // Create gradient
    function createGradient(ctx, colorStart, colorEnd) {
      const gradient = ctx.createLinearGradient(0, 0, 0, 300);
      gradient.addColorStop(0, colorStart);
      gradient.addColorStop(1, colorEnd);
      return gradient;
    }
  
    const ctx = document.getElementById("earningsChart").getContext("2d");
    console.log("Canvas Context:", ctx);
  
    const gradientRed = createGradient(ctx, "rgba(255, 0, 0, 0.8)", "rgba(255, 0, 0, 0)");
    const gradientBlue = createGradient(ctx, "rgba(0, 176, 255, 0.8)", "rgba(0, 176, 255, 0)");
  
    const chartData = {
      labels: daysInMonth,
      datasets: [
        {
          label: "Total Sales",
          data: totalSalesData,
          borderColor: "rgba(255, 0, 0, 1)",
          backgroundColor: gradientRed,
          pointBackgroundColor: "#fff",
          pointBorderColor: "#ff0000",
          pointRadius: 5,
          fill: true,
          tension: 0.5,
        },
        {
          label: "Total Profit",
          data: totalProfitData,
          borderColor: "rgba(0, 176, 255, 1)",
          backgroundColor: gradientBlue,
          pointBackgroundColor: "#fff",
          pointBorderColor: "#00b0ff",
          pointRadius: 5,
          fill: true,
          tension: 0.4,
        },
      ],
    };
  
    new Chart(ctx, {
      type: "line",
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: "Daily Total Sales and Profit",
            font: {
              size: 20,
            },
          },
          legend: {
            labels: {
              color: "#333",
              font: {
                size: 14,
              },
            },
          },
        },
        scales: {
          x: {
            ticks: {
              color: "#333",
              maxTicksLimit: 10,
            },
            grid: {
              color: "rgba(0, 0, 0, 0.1)",
            },
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: "#333",
            },
            grid: {
              color: "rgba(0, 0, 0, 0.1)",
            },
          },
        },
      },
    });
  </script>
    
      <div class="body-wrapper" style="margin-top: 8rem !important;">
        <div class="">
<div class="card card-body py-3">
  <div class="row align-items-center">
    <div class="col-12">
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
        
        <!-- Title + Icon -->
        <div class="d-flex align-items-center gap-2 p-4">
          <h4 class="mb-0 card-title">Inventory</h4>
          <i class="bi bi-clipboard-data" style="font-size:17px;"></i>
        </div>
        
        <!-- Search -->
        <form class="position-relative flex-grow-1 p-3" style="min-width:150px;">
          <input 
            type="text" 
            id="searchInput" 
            class="form-control search-chat py-2 ps-5 w-100" 
            placeholder="Search Product"
          >
          <i class="fa-solid fa-magnifying-glass position-absolute top-50 start-3 translate-middle-y fs-6 text-dark ms-3"></i>
        </form>

      </div>
    </div>
  </div>
</div>

      
          <div class="card card-body">
<!-- Hide table on small screens -->
<div class="table-responsive d-none d-md-block">
  <table class="table search-table align-middle text-nowrap" id="paginatedTable">
    <thead class="header-item text-center">
      <tr>
        <th>Image</th>
        <th>Product Name</th>
        <th>Details</th>
        <th>Sale Price</th>
        <th>Retail Price</th>
      </tr>
    </thead>
    <tbody id="table-body" class="text-center">
      <% if (typeof products !== 'undefined' && Array.isArray(products) && products.length > 0) { %>
        <% products.forEach(product => { %>
          <tr class="search-items" data-user-id="<%= product.id %>">
            <td>
              <span class="user-name mb-0 text-dark">
                <img src="/uploads/<%= product.device_image %>" alt="Device Icon" style="width: 30px; height: 30px; object-fit: cover">
              </span>
            </td>
            <td><span class="usr-location text-dark"><%= product.product_name %></span></td>
            <td>
              <span class="usr-location text-dark text-wrap" style="word-wrap: break-word; white-space: normal;">
                <%= product.gadget_problem %>
              </span>
            </td>
            <td><span class="usr-location text-dark"><%= product.Sale_Price %></span></td>
            <td><span class="usr-location text-dark"><%= product.Retail_Price %></span></td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>
</div>

<!-- Responsive Cards for small screens -->
<div class="d-md-none">
  <% if (typeof products !== 'undefined' && Array.isArray(products) && products.length > 0) { %>
    <% products.forEach(product => { %>
      <div class="card mb-3 border-0 shadow-sm rounded-3">
        <div class="card-body p-3">
          <div class="d-flex align-items-center mb-3">
            <img src="/uploads/<%= product.device_image %>" 
                 alt="Device Icon" 
                 class="rounded me-2 border" 
                 style="width: 45px; height: 45px; object-fit: cover;">
            <h6 class="mb-0 fw-semibold text-dark"><%= product.product_name %></h6>
          </div>
          <p class="mb-3 text-secondary small" style="word-wrap: break-word; white-space: normal; line-height: 1.4;">
            <%= product.gadget_problem %>
          </p>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-bold text-success">Sale: <%= product.Sale_Price %></span>
            <span class="fw-bold text-primary">Retail: <%= product.Retail_Price %></span>
          </div>
        </div>
      </div>
    <% }) %>
  <% } %>
</div>


          </div>
        </div>
      </div>
            <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <span id="tableInfo" class="text-muted">Showing <span id="currentEntries">0</span> entries</span>
              <nav style="margin-right:31px;">
                <ul class="pagination mb-0" id="pagination"></ul>
              </nav>
            </div>
          </div>


  
</body>
<script>
  // Table pagination
  document.addEventListener("DOMContentLoaded", () => {
    setTimeout(function() {
      const rowsPerPage = 10;
      let currentPage = 1;
      const tableRows = document.querySelectorAll('#paginatedTable tbody tr');
      const cardRows = document.querySelectorAll('.d-md-none > div');
      const totalRows = tableRows.length > 0 ? tableRows.length : cardRows.length;
      const totalPages = Math.ceil(totalRows / rowsPerPage);

      function showPage(page) {
        currentPage = page;
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        tableRows.forEach((row, index) => {
          row.style.display = (index >= start && index < end) ? '' : 'none';
        });

        cardRows.forEach((card, index) => {
          card.style.display = (index >= start && index < end) ? '' : 'none';
        });

        document.getElementById('currentEntries').textContent = Math.min(end, totalRows);
        updatePagination();
      }

      function updatePagination() {
        const pagination = document.getElementById('pagination');
        if (!pagination) return;
        pagination.innerHTML = '';

        const prevLi = document.createElement('li');
        prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
        prevLi.innerHTML = `<a class="page-link" href="#"><i class="bi bi-chevron-left me-1"></i> Previous</a>`;
        prevLi.addEventListener('click', (e) => {
          e.preventDefault();
          if (currentPage > 1) showPage(currentPage - 1);
        });
        pagination.appendChild(prevLi);

        const nextLi = document.createElement('li');
        nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
        nextLi.innerHTML = `<a class="page-link" href="#">Next <i class="bi bi-chevron-right ms-1"></i></a>`;
        nextLi.addEventListener('click', (e) => {
          e.preventDefault();
          if (currentPage < totalPages) showPage(currentPage + 1);
        });
        pagination.appendChild(nextLi);
      }

      if (totalRows > 0) showPage(1);
    }, 100);
  });
  // search
  const searchInput = document.getElementById("searchInput");
  const tableBody = document.getElementById("table-body");

  if (searchInput && tableBody) {
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();

      const rows = tableBody.querySelectorAll("tr");
      rows.forEach((row) => {
        const userName = row.querySelector(".user-name")?.textContent.toLowerCase() || '';
        const location = row.querySelector(".usr-location")?.textContent.toLowerCase() || '';

        if (userName.includes(query) || location.includes(query)) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    });
  }

</script>
<!-- footer -->
  <%- include('../par/footer.ejs') %>
  <!-- footer -->
 <!-- JavaScript Libraries -->
 <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Template Javascript -->
 <script src="js/main.js"></script>
</html>
