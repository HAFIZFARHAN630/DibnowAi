<style>
    @media screen and (max-width: 924px) {
            .sm-hide{
        display: none;
    }
    .content{
        overflow: hidden !important;
    }
    }
   
</style>


        <!-- Navbar Start -->
        <div class="content" style="max-width: 100vw !important;">
            <nav style="background-color: <%= navbar_color %> !important;" class="navbar navbar-expand sticky-top px-4 py-0" style="background-color: #F3F3F9; box-shadow: 5px 9px 10px rgba(0, 0, 0, 0.1);">


                <a href="/index" class="navbar-brand d-flex d-lg-none me-4">
                    <img  src="<%= info?.favicon ? '/uploads/' + info.favicon : '/images/DIB-NOW-512.png' %>"  alt="Profile Image" alt="Logo" style="width: 82px; height: auto; border: none; border-radius: 0;">
                </a>
                
                
                <a href="#" class="sidebar-toggler flex-shrink-0 " style="color: white;">
                    <i class="fa fa-bars"></i>
                </a>
                
                <% if (isUser) { %>
                <form class="d-md-flex ms-4 sm-hide">
                    <div class="patient-card-body p-4 position-relative" 
                        style="font-size: 2rem; font-weight: bold; padding: 0%; color: #333; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);">
                        <%= typeof plan_name !== "undefined" ? plan_name : "No Plan" %>
                    </div>
                    <a href="/pricing" class="ms-3"
                        style="font-size: 1.2rem; font-weight: bold; background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important; 
                               border: none; padding: 10px 20px; border-radius: 8px; color: white; text-decoration: none; 
                               display: inline-block; transition: all 0.3s ease-in-out; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                               position: relative; overflow: hidden;"
                        onmouseover="this.style.transform='scale(1.1)'; this.style.background='linear-gradient(45deg, #0056b3, #0041a3)'; 
                                     this.style.boxShadow='0 6px 12px rgba(0, 0, 0, 0.2)';"
                        onmouseout="this.style.transform='scale(1)'; this.style.background='linear-gradient(45deg, #007bff, #0056b3)';  this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                        Go to Plan
                    </a>
                </form>
                <% } %>
                
                
                
                
                
                
                <div class="navbar-nav align-items-center ms-auto">
                    <div class="nav-item dropdown">
              
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                           
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all message</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" id="notificationDropdown">
                            <i class="fa fa-bell me-lg-2 text-white position-relative">
                                <% if (isAdmin && typeof unreadCount !== 'undefined' && unreadCount > 0) { %>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notificationBadge">
                                        <%= unreadCount %>
                                    </span>
                                <% } else if (isAdmin) { %>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" id="notificationBadge">0</span>
                                <% } %>
                                <% if (isUser && typeof userUnreadCount !== 'undefined' && userUnreadCount > 0) { %>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="userNotificationBadge">
                                        <%= userUnreadCount %>
                                    </span>
                                <% } else if (isUser) { %>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" id="userNotificationBadge">0</span>
                                <% } %>
                            </i>
                            <span class="d-none d-lg-inline-flex text-dark">Notifications</span>
                        </a>

                        <%- include('notifications.ejs') %>
                        <% if (isUser) { %>
                            <%- include('userNotifications.ejs') %>
                        <% } %>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle d-flex align-items-center gap-1" data-bs-toggle="dropdown">
                            <img class="rounded-circle" src="<%- profileImagePath %>" alt="Profile Image" style="width: 40px; height: 40px;" onerror="this.onerror=null; this.src='/img/dumi img.png';">
                            <span class="d-none d-lg-inline-flex"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="/Setting" class="dropdown-item">Settings</a>
                            <a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#logoutModal">Logout</a>
                        </div>
                    </div>
                </div>
            </nav>
        <!-- Navbar End -->

        <!-- Logout Modal -->
        <div id="logoutModal" class="modal fade" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <div>
                            <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
                            <p class="modal-subtitle">Please select a reason and type 'LOGOUT' to confirm your session termination.</p>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="logoutForm" action="/logout" method="POST">
                            <div class="mb-4">
                                <label for="logoutReason" class="form-label">Reason for Logout</label>
                                <select class="form-control" id="logoutReason" name="reason" required>
                                    <option value="">Select a reason</option>
                                    <option value="End of work session">End of work session</option>
                                    <option value="Security reasons">Security reasons</option>
                                    <option value="Switching accounts">Switching accounts</option>
                                    <option value="System maintenance">System maintenance</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="confirmText" class="form-label">Confirmation Text</label>
                                <input type="text" class="form-control" id="confirmText" placeholder="Type LOGOUT to confirm" required />
                            </div>
                            <a href="/logout" type="submit" class="btn btn-danger w-100" id="logoutBtn" disabled>CONFIRM LOGOUT</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <style>
        /* Logout Modal Styles */
        #logoutModal .modal-dialog {
            max-width: 650px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
        }

        #logoutModal .modal-content {
            border: none;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
            min-height: 450px;
            overflow: hidden;
        }
        @media screen and (max-width:1024px) {
            #logoutModal .modal-content {
                width: 95vw;
                padding: 8px;
            }
            #logoutModal .modal-header {
                width: 95vw;
                padding: 8px !important;
                font-size: 12px !important;
            }
            #logoutModal {
                width: 95vw;
                padding: 8px;
            }
            #logoutModal .modal-body {
                padding: 8px !important;
            }
            #logoutModal .modal-title {
                font-size: 22px !important;
            }
        }
        #logoutModal .modal-header {
            border: none;
            padding: 45px 45px 25px;
            position: relative;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #d63031 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        #logoutModal .modal-title {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #logoutModal .modal-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.95);
            margin-top: 12px;
            line-height: 1.6;
        }

        #logoutModal .btn-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            border: none;
            border-radius: 50%;
            opacity: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #logoutModal .btn-close::before {
            content: 'Ã—';
            font-size: 26px;
            color: #dc2626;
            font-weight: bold;
        }

        #logoutModal .btn-close:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            transform: scale(1.1) rotate(90deg);
        }

        #logoutModal .modal-body {
            padding: 35px 45px 45px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        #logoutModal .form-label {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        #logoutModal .form-control {
            height: 55px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            padding: 15px 20px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        }

        #logoutModal .form-control:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.1);
            transform: translateY(-2px);
        }

        #logoutModal .btn-danger {
            height: 55px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #d63031 100%);
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        #logoutModal .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #ee5a24 0%, #d63031 50%, #b71c1c 100%);
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.4);
        }

        #logoutModal .btn-danger:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #logoutModal .mb-4 {
            margin-bottom: 25px !important;
        }
        
        /* Notification Styles */
        .notification-item {
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .notification-item.unread {
            background-color: #f8f9fa;
            border-left-color: #007bff;
        }
        
        .notification-item:hover {
            background-color: #e9ecef;
        }
        
        #notificationBadge {
            font-size: 0.7rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
     @media screen and (max-width: 1024px) {
  #notificationDropdown + .dropdown-menu,
  #userNotificationDropdown,
  .notification-container,
  #logoutModal
  {
    width: 95vw !important;
    position: fixed !important;
    top: 260px !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    right: auto !important;
    z-index: 9999 !important;
  }
  #logoutModal .btn-close{
    height: 20px !important;
    width: 20px !important;
    right: 35px !important;
  }
  #logoutModal .modal-header{
      padding: 12px !important;
  }
}

        /* @media screen and (max-width: 784px) {
  #notificationDropdown + .dropdown-menu,
  #userNotificationDropdown,
  .notification-container {
    width: 95vw !important;
    left: -50% !important;
    transform: translateX(-50%) !important;
    right: auto !important;
  }
} */

        </style>

        <!-- Socket.IO Client -->
        <script src="/socket.io/socket.io.js"></script>
        
        <script>
        // Notification Management (Admin only)
        <% if (isAdmin) { %>
        let socket, isSelectionMode = false;
        
        try { socket = io(); } catch (e) { console.error('Socket.IO failed:', e); }
        
        if (socket) {
          socket.on('newNotification', function(notification) {
            const badge = document.getElementById('notificationBadge');
            badge.textContent = (parseInt(badge.textContent) || 0) + 1;
            badge.classList.remove('d-none');
            
            const list = document.getElementById('notificationList');
            const empty = list.querySelector('.empty-notifications');
            if (empty) empty.remove();
            
            list.insertAdjacentHTML('afterbegin', `
                <div class="notification-item unread" data-id="${notification.id}">
                    <div class="d-flex align-items-start p-3 flex-wrap">
                        <div class="notification-checkbox d-none me-3">
                            <input type="checkbox" class="form-check-input notification-select" value="${notification.id}">
                        </div>
                        <div class="notification-avatar me-3">
                            <div class="avatar-circle bg-primary text-white d-flex align-items-center justify-content-center">
                                ${notification.userName.charAt(0).toUpperCase()}
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <h6 class="notification-user fw-bold mb-0 text-dark">${notification.userName}</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-primary rounded-pill px-2 py-1">New</span>
                                    <button class="btn btn-sm btn-outline-danger rounded-circle delete-notification" data-id="${notification.id}">
                                        <i class="fas fa-trash fa-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="notification-action mb-1 text-secondary">${notification.action}</p>
                            <small class="notification-time text-muted">
                                <i class="fas fa-clock me-1"></i>
                                ${new Date(notification.timestamp).toLocaleString()}
                            </small>
                        </div>
                    </div>
                </div>
            `);
            attachEvents();
          });
          
          socket.on('notificationsRead', function() {
            const badge = document.getElementById('notificationBadge');
            badge.textContent = '0';
            badge.classList.add('d-none');
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
                const b = item.querySelector('.badge');
                if (b) b.remove();
            });
          });
        }
        
        function attachEvents() {
            document.querySelectorAll('.delete-notification').forEach(btn => {
                btn.onclick = function(e) {
                    e.stopPropagation();
                    fetch(`/api/notifications/${this.dataset.id}`, {method: 'DELETE'})
                    .then(r => r.json())
                    .then(data => {
                        if (data.success) {
                            const item = document.querySelector(`[data-id="${this.dataset.id}"]`);
                            if (item?.classList.contains('unread')) {
                                const badge = document.getElementById('notificationBadge');
                                badge.textContent = Math.max(0, parseInt(badge.textContent) - 1);
                                badge.classList.toggle('d-none', badge.textContent === '0');
                            }
                            item?.remove();
                            checkEmpty();
                        }
                    });
                };
            });
            
            document.querySelectorAll('.notification-select').forEach(cb => {
                cb.onchange = () => {
                    const span = document.getElementById('selectedCount');
                    if (span) span.textContent = document.querySelectorAll('.notification-select:checked').length;
                };
            });
        }
        
        function checkEmpty() {
            const list = document.getElementById('notificationList');
            if (!list.querySelector('.notification-item')) {
                list.innerHTML = `
                    <div class="empty-notifications text-center py-5">
                        <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted mb-2">No notifications yet</h6>
                        <p class="text-muted small mb-0">You'll see notifications here when users perform actions</p>
                    </div>
                `;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Mark all as read
            document.getElementById('markAllRead')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                fetch('/api/notifications/mark-read', {method: 'POST', headers: {'Content-Type': 'application/json'}})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        const badge = document.getElementById('notificationBadge');
                        badge.textContent = '0';
                        badge.classList.add('d-none');
                        document.querySelectorAll('.notification-item.unread').forEach(item => {
                            item.classList.remove('unread');
                            const b = item.querySelector('.badge');
                            if (b) b.remove();
                        });
                    }
                });
            });
            
            // Selection mode toggle
            document.getElementById('selectAllNotifications')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                isSelectionMode = !isSelectionMode;
                document.querySelectorAll('.notification-checkbox').forEach(cb => cb.classList.toggle('d-none', !isSelectionMode));
                document.querySelector('.bulk-actions-bar')?.classList.toggle('d-none', !isSelectionMode);
                if (!isSelectionMode) {
                    document.querySelectorAll('.notification-select').forEach(cb => cb.checked = false);
                    const span = document.getElementById('selectedCount');
                    if (span) span.textContent = '0';
                }
            });
            
            // Close notifications
            document.getElementById('closeNotifications')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const dropdown = document.querySelector('.notification-container');
                const dropdownToggle = document.getElementById('notificationDropdown');
                if (dropdown && dropdownToggle) {
                    dropdown.classList.remove('show');
                    dropdownToggle.setAttribute('aria-expanded', 'false');
                    dropdownToggle.classList.remove('show');
                    document.body.click();
                }
            });
            
            // Bulk delete
            document.getElementById('deleteSelected')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const ids = Array.from(document.querySelectorAll('.notification-select:checked')).map(cb => cb.value);
                if (ids.length) {
                    fetch('/api/notifications/delete-multiple', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ids})
                    }).then(r => r.json()).then(data => {
                        if (data.success) {
                            let unread = 0;
                            ids.forEach(id => {
                                const item = document.querySelector(`[data-id="${id}"]`);
                                if (item?.classList.contains('unread')) unread++;
                                item?.remove();
                            });
                            const badge = document.getElementById('notificationBadge');
                            badge.textContent = Math.max(0, parseInt(badge.textContent) - unread);
                            badge.classList.toggle('d-none', badge.textContent === '0');
                            isSelectionMode = false;
                            document.querySelectorAll('.notification-checkbox').forEach(cb => cb.classList.add('d-none'));
                            document.querySelector('.bulk-actions-bar')?.classList.add('d-none');
                            checkEmpty();
                        }
                    });
                }
            });
            
            // Cancel selection
            document.getElementById('cancelSelection')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                isSelectionMode = false;
                document.querySelectorAll('.notification-checkbox').forEach(cb => cb.classList.add('d-none'));
                document.querySelector('.bulk-actions-bar')?.classList.add('d-none');
                document.querySelectorAll('.notification-select').forEach(cb => cb.checked = false);
                const span = document.getElementById('selectedCount');
                if (span) span.textContent = '0';
            });
            
            attachEvents();
        });
        <% } %>

        // User Notification Management
        <% if (isUser) { %>
        document.addEventListener('DOMContentLoaded', function() {
            // Mark all user notifications as read
            document.getElementById('markAllUserRead')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                fetch('/api/notifications/mark-user-read', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        const badge = document.getElementById('userNotificationBadge');
                        if (badge) {
                            badge.textContent = '0';
                            badge.classList.add('d-none');
                        }
                        document.querySelectorAll('#userNotificationList .notification-item.unread').forEach(item => {
                            item.classList.remove('unread');
                            const b = item.querySelector('.badge');
                            if (b) b.remove();
                        });
                    }
                });
            });

            // Close user notifications
            document.getElementById('closeUserNotifications')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const dropdown = document.querySelector('#userNotificationDropdown');
                const dropdownToggle = document.getElementById('notificationDropdown');
                if (dropdown && dropdownToggle) {
                    dropdown.classList.remove('show');
                    dropdownToggle.setAttribute('aria-expanded', 'false');
                    dropdownToggle.classList.remove('show');
                    document.body.click();
                }
            });
        });
        <% } %>

        document.addEventListener('DOMContentLoaded', function() {
            const confirmText = document.getElementById('confirmText');
            const logoutBtn = document.getElementById('logoutBtn');
            const reasonSelect = document.getElementById('logoutReason');
            
            function checkForm() {
                const isTextValid = confirmText.value.toUpperCase() === 'LOGOUT';
                const isReasonSelected = reasonSelect.value !== '';
                logoutBtn.disabled = !(isTextValid && isReasonSelected);
            }
            
            confirmText.addEventListener('input', checkForm);
            reasonSelect.addEventListener('change', checkForm);
        });
        </script>