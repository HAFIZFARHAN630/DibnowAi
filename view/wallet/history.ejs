<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Transaction History</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

   <!-- Icon Font Stylesheet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- Customized Bootstrap Stylesheet -->
    <link href="\bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="\styles.css" rel="stylesheet">
    <link href="\styles1.css" rel="stylesheet">
    
    
</head>
<style>
        .btn-back { 
            border-radius: 25px; 
            padding: 10px 20px; 
        }
        .history-table { 
            margin-top: 2rem; 
        }
        .status-success { 
            color: #28a745; 
        }
        .status-failed { 
            color: #dc3545; 
        }
        .btn-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 15px;
            color: white;
            font-weight: 700;
            padding: 12px 25px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
            color: white;
        }

        /* Professional Pagination Buttons */
        .pagination .page-link {
          background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important;
          color: white !important;
          border: none !important;
          font-weight: 600 !important;
          padding: 10px 24px !important;
          min-width: 120px !important;
          border-radius: 8px !important;
          transition: all 0.3s ease !important;
          box-shadow: 0 2px 8px rgba(0, 51, 204, 0.3) !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
        }

        .pagination .page-link:hover {
          transform: translateY(-2px) !important;
          box-shadow: 0 4px 12px rgba(0, 51, 204, 0.4) !important;
        }

        .pagination .page-item.disabled .page-link {
          background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
          opacity: 0.6 !important;
          cursor: not-allowed !important;
        }

        .pagination .page-item {
          margin: 0 4px !important;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>

<body>

    <%- include('../par/sidebar.ejs') %>

    <!-- Navbar Start -->
    <%- include('../par/header.ejs') %>
    <!-- Navbar End -->

    <div class="body-wrapper">
        <div class="container-fluid">
            <div class="card card-body py-3">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="d-sm-flex align-items-center justify-content-between">
                            <h4 class="mb-4 mb-sm-0 card-title me-1">Transaction History <i class="bi bi-clock-history"></i></h4>
                            <a href="/wallet" class="btn btn-gradient">Back to Wallet</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- content -->

            <div class="card card-body">
                <% if (typeof success_msg !== 'undefined' && success_msg.length>0) { %>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <%= success_msg %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <% } %>
                <% if (typeof error_msg !== 'undefined' && error_msg.length>0) { %>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <%= error_msg %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <% } %>
                <div class="text-center fw-bolder fs-6" >
                    <h4 style="color: #333333;">All Transactions</h4>
                   
                </div>


               

                <!-- Table (show only on md and up) -->
<div class="table-responsive hidden md:block">
  <table class="table table-striped table-hover history-table">
    <thead style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);color: white;">
      <tr style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);color: white;">
        <th style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); color: white;">Type</th>
        <th style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);color: white;">Amount</th>
        <th style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);color: white;">Date</th>
        <th style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);color: white;">Status</th>
      </tr>
    </thead>
    <tbody>
      <% if (transactions && transactions.length > 0) { %>
        <% transactions.forEach(txn => { %>
          <tr>
            <td><span class="badge bg-secondary"><%= txn.type.charAt(0).toUpperCase() + txn.type.slice(1) %></span></td>
            <td><strong>£<%= txn.amount.toFixed(2) %></strong></td>
            <td><%= new Date(txn.date).toLocaleString() %></td>
            <td><span class="badge <%= txn.status === 'success' ? 'bg-success' : 'bg-danger' %>"><%= txn.status.toUpperCase() %></span></td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr><td colspan="4" class="text-center">No transactions found.</td></tr>
      <% } %>
    </tbody>
  </table>
</div>

<!-- Card view (show only on small screens) -->
<div class="space-y-4 md:hidden">
  <% if (transactions && transactions.length > 0) { %>
    <% transactions.forEach(txn => { %>
      <div class="bg-white shadow rounded-lg p-4 border border-gray-200">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-semibold text-gray-600">Type:</span>
          <span class="px-2 py-1 text-xs rounded bg-gray-200"><%= txn.type.charAt(0).toUpperCase() + txn.type.slice(1) %></span>
        </div>
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-semibold text-gray-600">Amount:</span>
          <span class="text-base font-bold text-gray-800">£<%= txn.amount.toFixed(2) %></span>
        </div>
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-semibold text-gray-600">Date:</span>
          <span class="text-xs text-gray-700"><%= new Date(txn.date).toLocaleString() %></span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-sm font-semibold text-gray-600">Status:</span>
          <span class="px-2 py-1 text-xs rounded <%= txn.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
            <%= txn.status.toUpperCase() %>
          </span>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <div class="text-center text-gray-500 text-sm">No transactions found.</div>
  <% } %>
</div>


<!-- Pagination -->
<div class="d-flex justify-content-between align-items-center mt-4 px-3">
  <span id="tableInfo" class="text-muted">Showing <span id="currentEntries">0</span> entries</span>
  <nav>
    <ul class="pagination mb-0" id="pagination"></ul>
  </nav>
</div>

            </div>  
            <!-- Content End -->

        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          const rowsPerPage = 10;
          let currentPage = 1;
          const tableRows = document.querySelectorAll('.history-table tbody tr');
          const cardRows = document.querySelectorAll('.md\\:hidden > div');
          const totalRows = tableRows.length > 0 ? tableRows.length : cardRows.length;
          const totalPages = Math.ceil(totalRows / rowsPerPage);

          function showPage(page) {
            currentPage = page;
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;

            tableRows.forEach((row, index) => {
              row.style.display = (index >= start && index < end) ? '' : 'none';
            });

            cardRows.forEach((card, index) => {
              card.style.display = (index >= start && index < end) ? '' : 'none';
            });

            document.getElementById('currentEntries').textContent = Math.min(end, totalRows);
            updatePagination();
          }

          function updatePagination() {
            const pagination = document.getElementById('pagination');
            if (!pagination) return;
            pagination.innerHTML = '';

            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#"><i class="bi bi-chevron-left me-1"></i> Previous</a>`;
            prevLi.addEventListener('click', (e) => {
              e.preventDefault();
              if (currentPage > 1) showPage(currentPage - 1);
            });
            pagination.appendChild(prevLi);

            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#">Next <i class="bi bi-chevron-right ms-1"></i></a>`;
            nextLi.addEventListener('click', (e) => {
              e.preventDefault();
              if (currentPage < totalPages) showPage(currentPage + 1);
            });
            pagination.appendChild(nextLi);
          }

          if (totalRows > 0) showPage(1);
        }, 100);
      });
    </script>

</body>
</html>