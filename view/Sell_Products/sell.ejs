<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Sold Item</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

        <!-- Favicon -->
        <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">


    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Libraries Stylesheet -->

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">
</head>
<style>
.body-wrapper {
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

.footer {
    margin-top: auto;
    padding: 5px 0px 5px 50px;
    background-color: #dadae0;
    width: 109%;
    margin-left: -35px;
}

/* Enhanced Table Design - Same as adminfile.ejs */
.table {
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: none;
}

.table thead th {
  background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border: none;
  padding: 20px 15px;
  font-size: 14px;
}

.table tbody tr {
  transition: all 0.3s ease;
  border: none;
}

.table tbody tr:hover {
  background-color: #f8f9ff;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.table tbody td {
  padding: 18px 15px;
  border: none;
  border-bottom: 1px solid #f0f0f0;
  vertical-align: middle;
}

.table tbody tr.search-hidden {
  display: none;
}

.no-results {
  text-align: center;
  padding: 40px;
  color: #6b7280;
}

.no-results i {
  font-size: 48px;
  margin-bottom: 15px;
  opacity: 0.5;
}
/* --- Mobile cards & show/hide rules --- */
@media (max-width: 449px) {
  /* hide desktop table/card */
  .product-table-desktop { display: none !important; }

  /* show mobile cards */
  .product-cards-mobile { display: block !important; padding: 0.75rem; }
}

@media (min-width: 450px) {
  .product-cards-mobile { display: block !important; }
}

/* Card look & spacing */
.product-card {
  border-radius: 12px;
  background: linear-gradient(90deg,#ffffff,#f8fafc);
  box-shadow: 0 6px 18px rgba(15,23,42,0.06);
  padding: 12px;
  margin-bottom: 12px;
  border: 1px solid #eef2f7;
  overflow: hidden;
}

/* small labels and values */
.product-card .label {
  font-size: 11px;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.product-card .value {
  font-size: 14px;
  color: #0f172a;
  font-weight: 600;
  word-break: break-word;
}

/* actions layout */
.product-card .actions { display:flex; gap:8px; align-items:center; }

/* tighten spacing for very small screens */
@media (max-width: 320px) {
  .product-card { padding:10px; }
  .product-card .value { font-size:13px; }
}
@media screen and (max-width: 768px) {
  .hide-on-small{
    display: none !important;
  }
}

/* Professional Pagination Buttons */
.pagination .page-link {
  background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important;
  color: white !important;
  border: none !important;
  font-weight: 600 !important;
  padding: 10px 24px !important;
  min-width: 120px !important;
  border-radius: 8px !important;
  transition: all 0.3s ease !important;
  box-shadow: 0 2px 8px rgba(0, 51, 204, 0.3) !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
}

.pagination .page-link:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(0, 51, 204, 0.4) !important;
}

.pagination .page-item.disabled .page-link {
  background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

.pagination .page-item {
  margin: 0 4px !important;
}

/* Modal Close Button Hover Effect */
.close-btn:hover {
  transform: scale(1.1) rotate(90deg);
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
}

/* Modal Submit Button Hover Effect */
.btn-submit:hover {
  background: linear-gradient(135deg, #00E676 0%, #00C853 100%);
  transform: translateY(-3px);
  box-shadow: 0 15px 40px rgba(0, 200, 83, 0.5);
  color: #ffffff;
}

</style>


<body>
   

   <%- include('../par/sidebar.ejs') %>
    <%- include('../par/header.ejs') %>

<% if (success_msg.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong><i class="icon fa fa-check-circle me-2"></i><%= success_msg %></strong> 
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<% if (error_msg.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong><%= error_msg %></strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
 
<div class="body-wrapper" style="margin-top: 5rem !important;">
  <div class="container-fluid">
    <!-- Header Section -->
    <div class="card card-body py-3">
      <div class="row align-items-center">
        <div class="col-md-12">
          <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h4 class="mb-4 mb-sm-0 card-title">Sold Products</h4>
            <i class="bi bi-cash-stack" style="font-size:17px; padding-left:5px;"></i>
            <form class="position-relative ms-auto">
              <input type="text" id="searchInput" class="form-control search-chat py-2 ps-5" placeholder="Search Product">
              <i class="fa-solid fa-magnifying-glass position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="card card-body hide-on-small">
      <div class="table-responsive">
        <table class="table search-table align-middle text-nowrap" id="paginatedTable">
          <thead class="header-item text-center">
            <tr>
              <th style="width: 50px;">
                <input type="checkbox" id="selectAllSell" class="form-check-input" style="cursor: pointer; width: 18px; height: 18px;">
              </th>
              <th>Full Name</th>
              <th>Product Name</th>
              <th>Number</th>
              <th>Price</th>
              <th>Type</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody class="text-center" id="productTableBody">
            <% products.forEach((product) => { %>
              <tr id="product-<%- product.id %>" class="sell-row">
                <td>
                  <input type="checkbox" class="sell-row-checkbox form-check-input" data-id="<%- product.id %>" style="cursor: pointer; width: 18px; height: 18px;">
                </td>
                <td><%- product.fullName %></td>
                <td><%- product.Product %></td>
                <td><%- product.Number %></td>
                <td> <%- product.Price %></td>
                <td><%- product.Type %></td>
                <td class="d-flex justify-content-center gap-2">
                  <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" 
                  data-bs-target="#confirmModal<%= product.id %>">Edit</button>               
                    <!-- Delete form -->
                    <form action="/sells/delete/<%- product.id %>" method="POST" style="display:inline;">
                      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>  
                </td>
              </tr>
            <% }); %>
          </tbody> 
        </table>
      </div>
    </div>

<!-- Display this on small screens!!! -->
    <!-- MOBILE CARD LIST (visible on <450px) -->
<div class="product-cards-mobile">
  <% products.forEach((product) => { %>
    <div class="product-card d-xl-none">
      <!-- row 1: name + price -->
      <div class="d-flex justify-content-between align-items-start" style="gap:8px;">
        <div style="flex:1; min-width:0;">
          <div class="label">Full Name</div>
          <div class="value" style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
            <%- product.fullName %>
          </div>
        </div>
        <div style="margin-left:8px; text-align:right; min-width:80px;">
          <div class="label">Price</div>
          <div class="value"><%- product.Price %></div>
        </div>
      </div>

      <!-- row 2: product + number -->
      <div class="d-flex justify-content-between align-items-start mt-2" style="gap:8px;">
        <div style="flex:1; min-width:0;">
          <div class="label">Product</div>
          <div class="value" style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
            <%- product.Product %>
          </div>
        </div>
        <div style="margin-left:8px; text-align:right; min-width:80px;">
          <div class="label">Number</div>
          <div class="value"><%- product.Number %></div>
        </div>
      </div>

      <!-- row 3: type + actions -->
      <div class="d-flex justify-content-between align-items-center mt-2" style="gap:8px; flex-wrap:wrap;">
        <div>
          <div class="label">Type</div>
          <div class="value"><%- product.Type %></div>
        </div>

        <div class="actions">
          <!-- keep same modal target so nothing server-side changes -->
          <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#confirmModal<%= product.id %>">Edit</button>

          <form action="/sells/delete/<%- product.id %>" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  <% }) %>
</div>



  </div>
</div>


<!--  -->
<% products.forEach((product) => { %>
  <div class="modal fade" id="confirmModal<%= product.id %>" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 800px;">
      <div class="modal-content" style="background: transparent; border: none;">
        <div class="form-container" style="background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%); padding: 50px; border-radius: 25px; box-shadow: 0 30px 100px rgba(0, 0, 0, 0.2); position: relative; backdrop-filter: blur(15px); border: 2px solid rgba(255, 255, 255, 0.3);">
          <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); border: none; border-radius: 50%; color: white; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);">
            <i class="fas fa-times"></i>
          </button>
          <div class="form-header" style="text-align: center; margin-bottom: 35px;">
            <h2 style="font-size: 36px; font-weight: 700; color: #ffffff; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">Update Product</h2>
            <p style="color: rgba(255, 255, 255, 0.9); font-size: 18px; line-height: 1.5; margin: 0;">Update product information below</p>
          </div>
          <form action="/sells/update/<%= product.id %>" method="POST">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group" style="margin-bottom: 25px;">
                  <label for="fullName" class="form-label" style="font-weight: 600; color: #ffffff; margin-bottom: 12px; font-size: 18px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">Full Name</label>
                  <input type="text" class="form-control" name="fullName" value="<%= product.fullName %>" required style="width: 100%; height: 60px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 18px 25px; font-size: 18px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%); transition: all 0.3s ease; outline: none; backdrop-filter: blur(10px);">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group" style="margin-bottom: 25px;">
                  <label for="Number" class="form-label" style="font-weight: 600; color: #ffffff; margin-bottom: 12px; font-size: 18px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">Mobile Number</label>
                  <input type="number" class="form-control" name="Number" value="<%= product.Number %>" required style="width: 100%; height: 60px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 18px 25px; font-size: 18px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%); transition: all 0.3s ease; outline: none; backdrop-filter: blur(10px);">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group" style="margin-bottom: 25px;">
                  <label for="Price" class="form-label" style="font-weight: 600; color: #ffffff; margin-bottom: 12px; font-size: 18px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">Price</label>
                  <input type="number" class="form-control" name="Price" value="<%= product.Price %>" required style="width: 100%; height: 60px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 18px 25px; font-size: 18px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%); transition: all 0.3s ease; outline: none; backdrop-filter: blur(10px);">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group" style="margin-bottom: 25px;">
                  <label for="Type" class="form-label" style="font-weight: 600; color: #ffffff; margin-bottom: 12px; font-size: 18px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">Type</label>
                  <select class="form-select" name="Type" required style="width: 100%; height: 60px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 18px 25px; font-size: 18px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%); transition: all 0.3s ease; outline: none; backdrop-filter: blur(10px);">
                    <option value="New" <%= product.Type === 'New' ? 'selected' : '' %>>New Product</option>
                    <option value="Used" <%= product.Type === 'Used' ? 'selected' : '' %>>Used Product</option>
                    <option value="Return" <%= product.Type === 'Return' ? 'selected' : '' %>>Return Product</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group" style="margin-bottom: 25px;">
              <label for="Product" class="form-label" style="font-weight: 600; color: #ffffff; margin-bottom: 12px; font-size: 18px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">Product Name</label>
              <input type="text" class="form-control" name="Product" value="<%= product.Product %>" readonly required style="width: 100%; height: 60px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 18px 25px; font-size: 18px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%); transition: all 0.3s ease; outline: none; backdrop-filter: blur(10px);">
            </div>
            <button type="submit" class="btn-submit" style="width: 100%; height: 60px; background: linear-gradient(135deg, #00C853 0%, #00B894 100%); border: none; border-radius: 15px; color: #ffffff; font-size: 20px; font-weight: 700; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 30px rgba(0, 184, 148, 0.4); text-transform: uppercase; margin-top: 1rem;">Confirm</button>
          </form>
        </div>
      </div>
    </div>
  </div>
<% }); %>



<!-- Delete Selected Button -->
<div class="mb-4">
  <button id="deleteSelectedBtn"
          data-table="soldproducts"
          class="btn btn-danger shadow-sm px-4 py-2 fw-semibold"
          style="display: none;">
    <i class="fas fa-trash-alt me-2"></i> Delete Selected
  </button>
</div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <span id="tableInfo" class="text-muted">Showing <span id="currentEntries">0</span> entries</span>
      <nav style="margin-right:31px;">
        <ul class="pagination mb-0" id="pagination"></ul>
      </nav>
    </div>
  </div>
</div>
</div>

  

  <!-- footer -->
  <%- include('../par/footer.ejs') %>
  <!-- footer -->

<script>
document.addEventListener("DOMContentLoaded", () => {
  const selectAll = document.getElementById("selectAllSell");
  const checkboxes = document.querySelectorAll(".sell-row-checkbox");
  const deleteBtn = document.getElementById("deleteSelectedBtn");

  const toggleButton = () => {
    const selected = document.querySelectorAll(".sell-row-checkbox:checked").length;
    deleteBtn.style.display = selected > 0 ? "inline-flex" : "none";
  };

  if (selectAll) {
    selectAll.addEventListener("change", () => {
      checkboxes.forEach(cb => {
        if (cb.closest('tr').style.display !== 'none') {
          cb.checked = selectAll.checked;
        }
      });
      toggleButton();
    });
  }

  checkboxes.forEach(cb => cb.addEventListener("change", () => {
    const visibleCheckboxes = Array.from(checkboxes).filter(checkbox =>
      checkbox.closest('tr').style.display !== 'none'
    );
    const allChecked = visibleCheckboxes.length > 0 && visibleCheckboxes.every(cb => cb.checked);
    if (selectAll) selectAll.checked = allChecked;
    toggleButton();
  }));

  deleteBtn.addEventListener("click", async () => {
    const selectedIds = [...document.querySelectorAll(".sell-row-checkbox:checked")].map(cb => cb.dataset.id);
    if (selectedIds.length === 0) return alert("Please select at least one sold product to delete.");
    if (!confirm(`Delete ${selectedIds.length} selected sold product(s)?`)) return;

    try {
      const tableName = deleteBtn.dataset.table; // "soldproducts"
      const res = await fetch(`/delete-selected/${tableName}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selectedIds }),
      });

      const data = await res.json();
      if (data.success) {
        selectedIds.forEach(id => {
          const row = document.querySelector(`tr[id="product-${id}"]`);
          if (row) row.remove();
        });
        alert("Selected sold products deleted successfully.");
        toggleButton();
      } else {
        alert("Error deleting sold products: " + data.message);
      }
    } catch (err) {
      console.error(err);
      alert("Something went wrong.");
    }
  });

  toggleButton();
});

// search bar 
document.getElementById("searchInput").addEventListener("keyup", function() {
    const searchQuery = this.value.toLowerCase();
    const tableRows = document.querySelectorAll("#paginatedTable tbody tr");

    tableRows.forEach(row => {
      const fullName = row.querySelector("td:nth-child(1)").textContent.toLowerCase();
      const productName = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      
      if (fullName.includes(searchQuery) || productName.includes(searchQuery)) {
        row.style.display = ""; 
      } else {
        row.style.display = "none";  
      }
    });
  });

    // Table pagination
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(function() {
        const rowsPerPage = 10;
        let currentPage = 1;
        const tableRows = document.querySelectorAll('#paginatedTable tbody tr');
        const cardRows = document.querySelectorAll('.product-cards-mobile > .product-card');
        const totalRows = tableRows.length > 0 ? tableRows.length : cardRows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);

        function showPage(page) {
          currentPage = page;
          const start = (page - 1) * rowsPerPage;
          const end = start + rowsPerPage;

          tableRows.forEach((row, index) => {
            row.style.display = (index >= start && index < end) ? '' : 'none';
          });

          cardRows.forEach((card, index) => {
            card.style.display = (index >= start && index < end) ? '' : 'none';
          });

          document.getElementById('currentEntries').textContent = Math.min(end, totalRows);
          updatePagination();
        }

        function updatePagination() {
          const pagination = document.getElementById('pagination');
          if (!pagination) return;
          pagination.innerHTML = '';

          const prevLi = document.createElement('li');
          prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
          prevLi.innerHTML = `<a class="page-link" href="#"><i class="bi bi-chevron-left me-1"></i> Previous</a>`;
          prevLi.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage > 1) showPage(currentPage - 1);
          });
          pagination.appendChild(prevLi);

          const nextLi = document.createElement('li');
          nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
          nextLi.innerHTML = `<a class="page-link" href="#">Next <i class="bi bi-chevron-right ms-1"></i></a>`;
          nextLi.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage < totalPages) showPage(currentPage + 1);
          });
          pagination.appendChild(nextLi);
        }

        if (totalRows > 0) showPage(1);
      }, 100);
    });

</script>
</body>
 <!-- JavaScript Libraries -->
 <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Template Javascript -->
 <script src="js/main.js"></script>
 
</html>

