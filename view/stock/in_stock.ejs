<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>In Stock</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
        <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">

    
    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">

</head>
<body>
             <%- include('../par/sidebar.ejs') %>

        <!-- Navbar Start -->
   <%- include('../par/header.ejs') %>
   <%- include('../par/Add_Repair.ejs') %>
        <!-- Navbar End -->
         
        <% if (success_msg.length > 0) { %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong><i class="icon fa fa-check-circle me-2"></i><%= success_msg %></strong> 
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>
        <% if (error_msg.length > 0) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong><%= error_msg %></strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>
        
        <div class="body-wrapper">
    <div class="container-fluid">
      <div class="card card-body py-3">
        <div class="row align-items-center">
          <div class="col-12">
            <div class="d-sm-flex align-items-center justify-space-between">
              <h4 class="mb-4 mb-sm-0 card-title"> In Stock</h4>
                <i class="icon fa-solid fa-shop" style="font-size:17px;padding-left:5px;"></i>
              <nav aria-label="breadcrumb" class="ms-auto">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item d-flex align-items-center">
                    <a class="text-muted text-decoration-none d-flex" href="">
                      <iconify-icon icon="solar:home-2-line-duotone" class="fs-6"></iconify-icon>
                    </a>
                  </li>
                  <li class="breadcrumb-item" aria-current="page">
                    <button class="btn btn-action btn-primary" data-bs-toggle="modal" data-bs-target="#gadgetrModal"><i class="bi bi-clipboard-data"></i> Add Inventory</button>
                    <button class="btn btn-action btn-success" data-bs-toggle="modal" data-bs-target="#categoriesModal"><i class="bi bi-tags"></i> Add Category</button>                    
                    <button class="btn btn-action btn-dark" data-bs-toggle="modal" data-bs-target="#brandModal"><i class="bi bi-box"></i> Add Brand</button>                    
                  </li>
                </ol>
              </nav>
            </div>
          </div>
        </div>
      </div>


      <!-- filters -->
      <div class="card position-relative overflow-hidden">
        <div class="shop-part d-flex w-100">
          <!-- Sidebar Filters -->
          <div class="shop-filters flex-shrink-0 border-end d-none d-lg-block">
            <ul class="list-group pt-2 border-bottom rounded-0">
              <!-- Stock Filters -->
              <h6 class="my-3 mx-4 fw-semibold text-dark">Filter by Stock</h6>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="in-stock">
                  <i class="bi bi-check-circle"></i> In Stock
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="out-of-stock">
                  <i class="bi bi-x-circle"></i> Out of Stock
                </a>
              </li>
                <!-- Category Filters -->
              <h6 class="my-3 mx-4 fw-semibold text-dark">Filter by Category</h6>
              
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="all">
                  <i class="fa-regular fa-circle"></i> All
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="apple">
                  <i class="bi bi-phone"></i> Apple
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="samsung">
                  <i class="bi bi-phone"></i> Samsung
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="oneplus">
                  <i class="bi bi-phone"></i> OnePlus
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="google">
                  <i class="bi bi-phone"></i> Google
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="vivo">
                  <i class="bi bi-phone"></i> Vivo
                </a>
              </li>
              <li class="list-group-item border-0 p-0 mx-4 mb-2 rounded-3">
                <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-6" href="javascript:void(0)" data-filter="others">
                  <i class="bi bi-phone"></i> Others
                </a>
              </li>
      
            </ul>
          </div>
       <!-- filters -->


    <!-- products -->
    <div class="card-body p-4 pb-0">
      <div class="d-flex justify-content-between align-items-center gap-6 mb-4">
        <h5 class="fs-5 mb-0 d-none d-lg-block text-dark">All Products</h5>
        <form class="position-relative">
          <input type="text" class="form-control search-chat py-2 ps-5" id="text-srh" placeholder="Search Product">
          <i class="fa-solid fa-magnifying-glass position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>             
        </form>
      </div>
    
      <!-- Product Loop -->
      <div class="row">
        <% products.forEach(items => { %>
          <div class="col-sm-4 col-md-4 col-lg-4 mt-2 mb-2" data-category="<%= items.product_name %>" data-quantity="<%= items.Quantity %>">
            <div class="card overflow-hidden rounded-2 border h-100"> <!-- Added h-100 for equal height -->
              <div class="position-relative">
                <a href="/inStock_details/<%= items.id %>" class="hover-img d-block overflow-hidden">
                  <img 
                    src="<%= items.device_image ? `/uploads/${items.device_image}` : 'images/different mobiles.jpg' %>" 
                    class="product-image card-img-top rounded-0" 
                    alt="product-img"
                    style="height: 200px; object-fit: cover;"> 
                </a>
                <a href="javascript:void(0)" class="text-bg-primary rounded-circle p-2 text-white d-inline-flex position-absolute bottom-0 end-0 mb-n3 me-3" data-bs-toggle="modal" data-bs-target="#updateModal<%= items.id %>">
                  <i class="bi bi-pencil" style="align-items: center; display: flex;"></i>
                </a>
              </div>
              <div class="card-body pt-3 p-3 d-flex flex-column">
                <h6 class="fw-semibold fs-4 text-dark">Product Name: <%= items.product_name %></h6>
                <h6 class="fw-semibold fs-4 text-dark">Retail Price:<%= items.Retail_Price %></h6>
                <h6 class="fw-semibold fs-4 text-dark">Category: <%= items.Category %></h6>
                <h6 class="fw-semibold fs-4 text-dark">Quantity: <%= items.Quantity %></h6>
      
                <% if (items.Quantity > 0) { %>
                  <!-- Flex container for buttons -->
                  <div class="d-flex justify-content-between gap-3 mt-auto"> 
                    <!-- Sold button triggers the modal -->
                    <button type="button" class="badge sell-btn btn btn-success w-50" data-bs-toggle="modal"  data-bs-target="#confirmModal<%= items.id %>"> <i class="fa-solid fa-cart-shopping"></i> Sell  </button>
                    <!-- Delete button -->
                    <form action="/delete/<%= items.id %>" method="POST" class="category-form w-50"> 
                      <button type="submit" class="badge sell-btn btn btn-danger w-100" aria-label="Delete"  style="height: 36px;">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                    
                    </form>
                  </div>
                <% } else { %>
                  <div class="d-flex justify-content-between gap-3 mt-auto"> 
                    <button disabled class="badge out-of-stock btn btn-danger w-50">
                      <i class="fa-solid fa-cart-shopping"></i> Stock Out 
                    </button>
                    <form action="/delete/<%= items.id %>" method="POST" class="category-form w-50"> 
                      <button type="submit" class="badge sell-btn btn btn-danger w-100"> <i class="fa-solid fa-trash"></i> Delete </button>
                    </form>
                  </div>
                <% } %>
              </div>
            </div>
          </div>
        <% }); %>
      </div>

<!-- Confirmation Modal (for Sold button) -->
<% products.forEach(items => { %>
  <div class="modal fade" id="confirmModal<%= items.id %>" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content gadget-form-modal" style="margin-top: -23px;">
        <div class="modal-header">
          <h3 class="modal-title text-dark" id="gadgetRepairModalLabel" style="margin-left: auto; font-size: xx-large;margin-bottom: -17px;">Confirm Sale</h3>
          <button type="button" class="btn-close gadget-close-btn" data-bs-dismiss="modal" aria-label="Close">               
            <i class="fas fa-times gadget-close-btn" data-bs-dismiss="modal" aria-label="Close"></i>
          </button>
        </div>
        <div class="modal-body" style="padding-top: 17px;">
          <!-- Update the form action to include the product ID -->
          <form action="/sell/<%= items.id %>" method="POST" class="gadget-form">
            <!-- Hidden input to pass the product ID -->
            <input type="hidden" name="productId" value="<%= items.id %>">
            <div class="row">
              <div class="col-md-6">
                <label for="fullName" class="form-label">Full Name</label>
                <input type="text" class="form-control gadget-input" name="fullName" required>
              </div>
              <div class="col-md-6">
                <label for="Number" class="form-label">Mobile Number</label>
                <input type="number" class="form-control gadget-input" name="Number" required>
              </div>
            </div>
            <!-- Price and Type inputs -->
            <div class="row">
              <div class="col-md-6 mt-n2">
                <label for="Price" class="form-label">Price</label>
                <input type="number" class="form-control gadget-input" name="Price" value="" required>
              </div>
              <div class="col-md-6 mt-n2">
                <label for="Price" class="form-label">Type</label>
                <select class="form-select gadget-select" name="Type" required>
                  <option value="New">New Product</option>
                  <option value="Used">Used Product</option>
                  <option value="Return">Return Product</option>
                </select>
              </div>
            </div>
            <!-- Product Name (readonly) -->
            <div class="row">
              <div class="col-md-6 mt-n2">
                <label for="Product" class="form-label">Product Name</label>
                <input type="text" class="form-control gadget-input" name="Product" value="<%= items.product_name %>" readonly required>
              </div>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer gap-3">
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-success">Confirm</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
<% }); %>

</div>
</div>
</div>
</div>
    <!-- footer -->
    <%-include('../par/footer.ejs')%>
    <!-- footer -->

<!-- Add Product  form-->  
<% products.forEach(items => { %>
  <div class="modal fade" id="updateModal<%= items.id %>" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content gadget-form-modal" style="height: 551px;margin-top: -23px;">
          <div class="modal-header ">
              <h5 class="modal-title text-dark" id="gadgetRepairModalLabel" style="margin-left: auto; font-size: xx-large;margin-bottom: -17px;">Add Product</h5>
              <button type="button" class="btn-close gadget-close-btn" data-bs-dismiss="modal" aria-label="Close">              
                  <i class="fas fa-times gadget-close-btn" data-bs-dismiss="modal" aria-label="Close"></i>
              </button>
          </div>
          <div class="modal-body" style="padding-top: 17px;">
              <form action="/update/<%= items.id %>" method="POST" enctype="multipart/form-data" class="gadget-form">
                  <div class="row">
                      <div class="col-md-6">
                          <label for="product_name" class="form-label">Product Name <span class="text-danger">*</span></label>
                          <input type="text" name="product_name" value="<%= items.product_name %>" class="form-control gadget-input" id="product_name" required>
                      </div>

                      <div class="col-md-6 ">
                          <label for="Model" class="form-label">Model</label>
                          <input type="text" name="Model" value="<%= items.Model %>" class="form-control gadget-input" id="Model" required>
                      </div>
                  </div>

                  <div class="row  justify-content-between">
                      <div class="col-md-4">
                          <label for="Brand" class="form-label">Brand</label>
                          <select class="form-select gadget-select" name="brand" id="brand" required>
                            <option value="Apple">Apple</option>
                                  <option value="Samsung">Samsung</option>
                                  <option value="Oppo">Oppo</option>
                                  <option value="Xiaomi">Xiaomi</option>
                                  <option value="OnePlus">OnePlus</option>
                                  <option value="Realme">Realme</option>
                                  <option value="Vivo">Vivo</option>
                        </select>  
                      </div>
                      <div class="col-md-4">
                          <label for="Category" class="form-label">Category</label>
                          <select class="form-select gadget-select" name="Category" id="Category" required>
                            <option value="Mobile">New Mobile</option>
                            <option value="Used Mobile">Used Mobile</option>
                          </select>
                      </div>  
                      <div class="col-md-4">
                          <label for="Color" class="form-label">Color</label>
                          <input type="color" name="Color" value="<%= items.Color %>" class="form-control gadget-input" id="Color">
                      </div>
                  </div>
                  <div class="row  justify-content-between">
                      <div class="col-md-4">
                          <label for="Sale_Price" class="form-label">Sale Price</label>
                          <input type="number" value="<%= items.Sale_Price %>" name="Sale_Price" class="form-control gadget-input" id="Sale_Price" required>
                      </div>
                      <div class="col-md-4 ">
                           <label for="Retail_Price" class="form-label">Retail Price</label>
                          <input type="number" value="<%= items.Retail_Price %>" name="Retail_Price" class="form-control gadget-input" id="Retail_Price" required>
                      </div>
                      <div class="col-md-4">
                          <label for="imei_number" class="form-label">IMEI Number (if any)</label>
                          <input type="text" value="<%= items.imei_number %>" name="imei_number" class="form-control gadget-input" id="imei_number">
                      </div>   

                      <div class="col-md-6">
                        <label for="Quantity" class="form-label">Quantity</label>
                        <input type="number" name="Quantity" value="<%= items.Quantity %>" class="form-control gadget-file" id="Quantity">
                    </div>
                      <div class="col-md-6">
                          <label for="device_image" class="form-label">Upload Mobile Image</label>
                          <input type="file"  name="device_image"  value="<%= profileImagePath %>"  class="form-control gadget-file" id="device_image">
                        </div>
                  </div>
                  <div class="mb-3">
                      <label for="gadgetProblem" class="form-label">Device Details <span class="text-danger">*</span></label>
                      <textarea class="form-control gadget-textarea"  id="gadgetProblem" name="gadget_problem" rows="2" placeholder="Describe your Device Details"><%= items.gadget_problem %></textarea>
                  </div>
                  <button type="submit" class="btn gadget-submit-btn ">Submit</button>
                </form>
          </div>
    
      </div>
  </div>
  </div>   
  <% }); %>   
   </div>
 

 
 
<!-- End Add Product  form-->

<script>  
  // Filtering functionality
  document.addEventListener("DOMContentLoaded", () => {
    const filterLinks = document.querySelectorAll('.shop-filters a[data-filter]');
    const productCards = document.querySelectorAll('[data-category]');
    const predefinedCategories = ['apple', 'samsung', 'oneplus', 'google', 'vivo'];
  
    filterLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const filter = link.getAttribute('data-filter').toLowerCase();
  
        productCards.forEach(card => {
          const productCategory = card.getAttribute('data-category').toLowerCase();
          const productQuantity = parseInt(card.getAttribute('data-quantity'));
  
          if (filter === 'all') {
            // Show all products
            card.style.display = '';
          } else if (filter === 'in-stock') {
            // Show only products with stock quantity > 0
            card.style.display = productQuantity > 0 ? '' : 'none';
          } else if (filter === 'out-of-stock') {
            // Show only products with stock quantity = 0
            card.style.display = productQuantity === 0 ? '' : 'none';
          } else if (filter === 'others') {
            // Show products not in predefined categories
            card.style.display = predefinedCategories.includes(productCategory) ? 'none' : '';
          } else {
            // Show products matching the selected category
            card.style.display = productCategory.includes(filter) ? '' : 'none';
          }
        });
      });
    });
  });
  
  // Search functionality
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("text-srh");
    const productCards = document.querySelectorAll('[data-category]');
  
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
  
      productCards.forEach(card => {
        const productName = card.getAttribute("data-category").toLowerCase();
        if (productName.includes(query)) {
          card.style.display = "";
        } else {
          card.style.display = "none";
        }
      });
    });
  });
  </script>

</body>
        <!-- JavaScript Libraries -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    
        <!-- Template Javascript -->
        <script src="js/main.js"></script>
</html>


 
