<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Clients</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

        <!-- Favicon -->
            <link rel="icon" href="\images\DIB-NOW-512.png" type="image/x-icon">


    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.css" rel="stylesheet">
    <!-- Template Stylesheet -->
    <link href="styles.css" rel="stylesheet">
    <link href="styles1.css" rel="stylesheet">
<style>
  .body-wrapper {
  min-height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
    margin-top: auto;
    padding:5px 11px 5px 95px;
    background-color: #dadae0;
    text-align: center;
    width: 109%;
    margin-left: -35px;
      }

  .btn-gradient {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: 2px solid rgba(16, 185, 129, 0.3);
    border-radius: 15px;
    color: white;
    font-weight: 700;
    padding: 12px 25px;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #text-srh {
    border-radius: 25px;
    background-color: #f8f9fa;
    border: 2px solid #e9ecef;
    color: #212529;
    padding: 10px 20px;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  #text-srh:focus {
    background-color: #ffffff;
    border-color: #10b981;
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25);
    color: #212529;
  }

  #text-srh::placeholder {
    color: #6c757d;
  }

  .btn-gradient:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
    color: white;
  }

  /* Search functionality */
  .search-container {
    position: relative;
    margin-bottom: 20px;
  }

  .search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    z-index: 10;
  }

  .search-input-wrapper {
    position: relative;
  }

  .search-input-wrapper input {
    padding-left: 45px;
  }

  /* Enhanced Table Design */
  .table {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border: none;
  }

  .table thead th {
    background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);
    color: white;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: none;
    padding: 20px 15px;
    font-size: 14px;
  }

  .table tbody tr {
    transition: all 0.3s ease;
    border: none;
  }

  .table tbody tr:hover {
    background-color: #f8f9ff;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }

  .table tbody td {
    padding: 18px 15px;
    border: none;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
  }

  /* Button Styling */
  .btn-action {
    border-radius: 8px;
    font-weight: 600;
    padding: 8px 16px;
    transition: all 0.3s ease;
  }

  .btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .table tbody tr.search-hidden {
    display: none;
  }

  .no-results {
    text-align: center;
    padding: 40px;
    color: #6b7280;
  }

  .no-results i {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
  }
  @media screen and (max-width:786px){
    .j-c-m-s{
      justify-content: center !important;
      align-items: center !important;
    }
    .j-c-m-s .btn{
      width: 100% !important;
      margin-left: 30px;
    }
    .hide-on-small{
      display: none !important;
    }
  }

  /* Modal Redesign */
  .modal-content.gadget-form-modal {
    background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%);
    border-radius: 25px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 30px 100px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(15px);
  }

  .modal-header {
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    padding: 30px;
    position: relative;
  }

  .modal-title {
    color: #ffffff !important;
    font-weight: 700 !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    margin: 0 !important;
    font-size: 28px !important;
  }

  .gadget-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
  }

  .gadget-close-btn:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
  }

  .modal-body {
    padding: 30px;
  }

  .gadget-form .form-label {
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 12px;
    font-size: 16px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  .gadget-form .gadget-input,
  .gadget-form .gadget-select {
    width: 100%;
    height: 50px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 16px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
    transition: all 0.3s ease;
    margin-bottom: 15px;
  }

  .gadget-form .gadget-input:focus,
  .gadget-form .gadget-select:focus {
    border-color: rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.98);
  }

  .gadget-submit-btn {
    width: 100%;
    height: 50px;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    color: #0033cc;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
    text-transform: uppercase;
    margin-top: 20px;
  }

  .gadget-submit-btn:hover {
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(255, 255, 255, 0.3);
  }

  /* Status Select Colors */
  .status-select {
    font-weight: 600;
    border-radius: 8px;
    padding: 8px 12px;
    border: 2px solid;
    transition: all 0.3s ease;
    color: white;
  }

  .status-select.Pending { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border-color: #ffc107; }
  .status-select.Cancelled { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border-color: #dc3545; }
  .status-select.Progress { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); border-color: #007bff; }
  .status-select.Completed { background: linear-gradient(135deg, #28a745 0%, #218838 100%); border-color: #28a745; }
  .status-select.Delivered { background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); border-color: #6f42c1; }

  .status-select option[value="Pending"] { background: #ffc107; color: white; }
  .status-select option[value="Cancelled"] { background: #dc3545; color: white; }
  .status-select option[value="Progress"] { background: #007bff; color: white; }
  .status-select option[value="Completed"] { background: #28a745; color: white; }
  .status-select option[value="Delivered"] { background: #6f42c1; color: white; }

  /* Professional Pagination Buttons */
  .pagination .page-link {
    background: linear-gradient(135deg, #0033cc 0%, #33ccff 100%) !important;
    color: white !important;
    border: none !important;
    font-weight: 600 !important;
    padding: 10px 24px !important;
    min-width: 120px !important;
    border-radius: 8px !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 2px 8px rgba(0, 51, 204, 0.3) !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .pagination .page-link:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(0, 51, 204, 0.4) !important;
  }

  .pagination .page-item.disabled .page-link {
    background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%) !important;
    opacity: 0.6 !important;
    cursor: not-allowed !important;
  }

  .pagination .page-item {
    margin: 0 4px !important;
  }
  .padd{
    padding: 28px;
  }
  @media screen and (max-width: 786px) {
    .padd{
      padding: 18px;
    }
   .center-on-small {
        justify-content: center !important;
        display: flex;

        flex-direction: column;
        width: 100% !important;
        justify-content: center;
    }
  }
  #text-srh{
    margin-top: 15px;
  }
</style>
</head>
<body style="max-width: 100vw !important; overflow-x: hidden !important;">  
      <%- include('../par/sidebar.ejs') %>

<!-- Navbar Start -->
<%- include('../par/header.ejs') %>

<% if (success_msg.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong><i class="icon fa fa-check-circle me-2"></i><%= success_msg %></strong> 
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<% if (error_msg.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong><%= error_msg %></strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
       <!-- Navbar End -->
        <!--  -->
  <%- include('../par/Add_Repair.ejs') %>
  <!--  -->
  <div  class="action-buttons j-c-m-s" style="display:flex; justify-content: end; margin-top: 10px; gap: 5px; margin-right:41px; flex-wrap: wrap;">
    <button class="btn btn-action btn-danger" style="width: fit-content;" data-bs-toggle="modal" data-bs-target="#gadgetRepairModal"><i class="bi bi-tools"></i> Add Repair Customer </button> 
    <button class="btn btn-action btn-primary" style="width: fit-content;" data-bs-toggle="modal" data-bs-target="#gadgetrModal"><i class="bi bi-clipboard-data"></i> Add Inventory</button>
  </div>
<!-- content -->
<div class="body-wrapper">
  <div class="container-fluid">
    <div class="card card-body py-3 padd" style="">
   <!-- REPLACE the existing flex wrapper with this (Bootstrap only) -->
<div class="d-flex flex-column flex-sm-row flex-wrap justify-content-center justify-content-sm-between align-items-center gap-3 w-100">
  
  <!-- Left: Title + Icon -->
  <div class="d-flex align-items-center gap-2">
    <h4 class="mb-0 card-title">Clients</h4>
    <i class="fa-solid fa-user-group"></i>
  </div>

  <!-- Middle: Action Buttons (ms-sm-auto pushes them right on sm+) -->
  <div class="d-flex flex-wrap gap-2 ms-sm-auto center-on-small">
    <button class="btn btn-action btn-primary" onclick="generatePDF()">
      <i class="fa fa-file-pdf"></i> PDF
    </button>
    <button class="btn btn-action btn-success" onclick="generateExcel()">
      <i class="fa fa-file-excel"></i> Excel
    </button>
    <button class="btn btn-action btn-info" onclick="printTable()">
      <i class="fa fa-print"></i> Print
    </button>
    <button id="deleteSelectedBtn"
            data-table="clients"
            class="btn btn-action btn-danger"
            style="display: none;">
      <i class="fas fa-trash-alt me-2"></i> Delete Selected
    </button>
  </div>

  <!-- Right: Search (full width on xs, auto on sm+) -->
  <div class="search-container w-100 w-sm-auto">
    <div class="search-input-wrapper w-100">
      <input
        type="text"
        class="form-control"
        id="text-srh"
        placeholder="Search Product"
        oninput="filterTable()"
      />
    </div>
  </div>

</div>

</div>

<!-- content -->

      <!-- Clients -->
      <div class="card card-body" style="padding: 0 !important;">
<!-- Table (desktop only) -->
<div class="table-responsive d-none d-xl-block">
  <table class="table search-table align-middle text-nowrap" id="paginatedTable">
    <thead class="header-item text-center hide-on-small">
      <tr>
        <th>
          <div class="n-chk align-self-center text-center">
            <div class="form-check">
              <input type="checkbox" class="form-check-input primary" id="contact-check-all" onclick="toggleSelectAll(this)" />
              <label class="form-check-label" for="contact-check-all"></label>
            </div>
          </div>
        </th>
        <th>Name</th>
        <th>Email</th>
        <th>Brand</th>
        <th>Status</th>
        <th class="text-center">Action</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <% products.forEach(product => { %>
      <tr class="search-items" data-user-id="<%= product.id %>">
        <td>
          <div class="n-chk align-self-center text-center">
            <div class="form-check">
              <input type="checkbox" class="form-check-input contact-chkbox primary" value="<%= product.id %>" />
              <label class="form-check-label"></label>
            </div>
          </div>
        </td>
        <td>
          <div class="d-flex align-items-center">
            <img src="<%= product.deviceImage %>" alt="avatar" class="rounded-circle" style="width: 30px; height: 30px; object-fit: cover" />
            <div class="ms-3">
              <span class="user-name mb-0 text-dark"><%= product.fullName %></span>
            </div>
          </div>
        </td>
        <td><%= product.email %></td>
        <td><%= product.brand %></td>
        <td>
          <select class="status-select <%= product.status %>" onchange="updateStatus('<%= product.id %>', this.value)">
            <option value="Pending" <%= product.status === 'Pending' ? 'selected' : '' %>>Pending</option>
            <option value="Cancelled" <%= product.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
            <option value="Progress" <%= product.status === 'Progress' ? 'selected' : '' %>>Progress</option>
            <option value="Completed" <%= product.status === 'Completed' ? 'selected' : '' %>>Completed</option>
            <option value="Delivered" <%= product.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
          </select>
        </td>
        <td class="d-flex justify-content-end">
          <div class="action-btn d-flex">
            <button class="btn text-black" onclick="printTable('<%= product.id %>')">
              <i class="fa fa-print"></i> Print
            </button>
            <button type="button" class="btn btn-link text-primary edit" data-bs-toggle="modal" data-bs-target="#editUserModal<%= product.id %>">
              <i class="fs-4 fa-solid fa-pen-to-square text-primary"></i>
            </button>
            <form action="/Clients/<%= product.id %>" method="POST">
              <button type="submit" class="btn btn-link text-danger">
                <i class="fa-solid fa-trash-can text-danger"></i>
              </button>
            </form>
          </div>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<!-- Cards (mobile only) -->
<div class="d-xl-none">
  <div class="row g-3">
    <% products.forEach(product => { %>
    <div class="col-12">
      <div class="card shadow-sm border rounded h-100">
        <div class="card-body d-flex flex-column gap-3">
          <!-- Header -->
          <div class="d-flex align-items-center gap-3">
            <input type="checkbox" class="form-check-input contact-chkbox primary" value="<%= product.id %>" />
            <div>
              <h6 class="mb-0 text-dark fw-bold" style="font-weight: bolder !important;"><%= product.fullName %></h6>
              <small class="text-muted" style="font-size: x-small;"><%= product.email %></small>
            </div>
          </div>

          <!-- Details -->
          <div class="text-dark small">
            <p class="mb-1"><strong>Brand:</strong> <%= product.brand %></p>
            <p class="mb-1"><strong>Status:</strong></p>
            <select class="form-select form-select-sm status-select <%= product.status %>" onchange="updateStatus('<%= product.id %>', this.value)">
              <option value="Pending" <%= product.status === 'Pending' ? 'selected' : '' %>>Pending</option>
              <option value="Cancelled" <%= product.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
              <option value="Progress" <%= product.status === 'Progress' ? 'selected' : '' %>>Progress</option>
              <option value="Completed" <%= product.status === 'Completed' ? 'selected' : '' %>>Completed</option>
              <option value="Delivered" <%= product.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
            </select>
          </div>

          <!-- Actions -->
          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-sm btn-outline-dark" onclick="printTable('<%= product.id %>')">
              <i class="fa fa-print"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-primary edit" data-bs-toggle="modal" data-bs-target="#editUserModal<%= product.id %>">
              <i class="fa-solid fa-pen-to-square"></i>
            </button>
            <form action="/Clients/<%= product.id %>" method="POST">
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <% }); %>
  </div>
</div>

      </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <span id="tableInfo" class="text-muted">Showing <span id="currentEntries">0</span> entries</span>
          <nav>
            <ul class="pagination mb-0" id="pagination"></ul>
          </nav>
        </div>
      </div>

    </div>
  </div>

    <!-- Content End -->

    

  <!-- footer -->
  <%- include('../par/footer.ejs') %>
  <!-- footer -->

<!--  Form -->
<% products.forEach(product => { %>
  <div class="modal fade" id="editUserModal<%= product.id %>" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content gadget-form-modal" style="width:100%;">
        <div class="modal-header">
          <h5 class="modal-title" id="editUserModalLabel">Update Clients</h5>
          <button type="button" class="gadget-close-btn" data-bs-dismiss="modal" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <form action="/Clients/update/<%= product.id %>" method="POST" id="editUserForm<%= product.id %>" class="gadget-form">
            <input type="hidden" name="id" value="<%= product.id %>" />
            <div class="col-md-12">
              <label for="fullName-<%= product.id %>" class="form-label">Full Name</label>
              <input type="text" class="form-control gadget-input" name="fullName" id="fullName-<%= product.id %>" value="<%= product.fullName %>" required>
            </div>
            <div class="col-md-12">
              <label for="email-<%= product.id %>" class="form-label">Email</label>
              <input type="email" class="form-control gadget-input" name="email" id="email-<%= product.id %>" value="<%= product.email %>" required>
            </div>
            <div class="row">
              <div class="row ">
                <div class="col-md-6 ">
                    <label for="brand" class="form-label">Brand Name</label>
                    <select class="form-select gadget-select" name="brand" id="Brand" required>
                        <% brand.forEach(brand => { %>
                            <option value="<%= brand.name %>">
                              <%= brand.name %>
                            </option>
                          <% }); %>
                          <option value="Vivo">Vivo</option>
                    </select>  
                </div>
              <div class="form-group col-md-6">
                <label for="status-<%= product.id %>" class="form-label">Status</label>
                <select class="form-control gadget-select status-select <%= product.status %>" id="status-<%= product.id %>" name="status" onchange="updateStatus('<%= product.id %>', this.value)">
                  <option value="Pending" <%= product.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                  <option value="Cancelled" <%= product.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                  <option value="Progress" <%= product.status === 'Progress' ? 'selected' : '' %>>Progress</option>
                  <option value="Completed" <%= product.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                  <option value="Delivered" <%= product.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                </select>
              </div>
            </div>
          </div>
            <!-- Submit Button -->
            <div class="btn-add">
              <button type="submit" class="btn gadget-submit-btn">
                Update Clients
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <% }); %>
    <!-- Form -->
</body>


<script>
  // Update status and change dropdown color
  function updateStatus(productId, status) {
    const selectElement = event.target;
    selectElement.className = 'status-select ' + status;
    
    fetch(`/Clients/${productId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: status }),
    })
    .then(response => {
      if (response.ok) console.log('Status updated successfully');
    })
    .catch(error => console.error('Error updating status:', error));
  }

  // search bar
  function filterTable() {
    const searchValue = document.getElementById('text-srh').value.toLowerCase();
    const rows = document.querySelectorAll('tbody .search-items'); 
    rows.forEach(row => {
        const fullName = row.querySelector('.user-name') ? row.querySelector('.user-name').textContent.toLowerCase() : '';
        const email = row.querySelector('.usr-email-addr') ? row.querySelector('.usr-email-addr').textContent.toLowerCase() : '';
        const brand = row.querySelector('.usr-location') ? row.querySelector('.usr-location').textContent.toLowerCase() : '';
        const status = row.querySelector('.status-select') ? row.querySelector('.status-select option:checked').textContent.toLowerCase() : '';
        // Check if any of the fields match the search input value
        if (
            fullName.includes(searchValue) ||
            email.includes(searchValue) ||
            brand.includes(searchValue) ||
            status.includes(searchValue)
        ) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
// Pdf select
  document.querySelector('.btn-action i.fa-file-pdf').parentElement.addEventListener('click', function () {
             
              const content = document.querySelector('.container-fluid');
      
            
              html2canvas(content, { scale: 2}).then((canvas) => {
                  const imgData = canvas.toDataURL('image/png');
                  const pdf = new jspdf.jsPDF('p', 'mm', 'a4'); // Portrait, millimeters, A4 size
      
                  // Dimensions for the PDF
                  const pdfWidth = 190; 
                  const pdfHeight = (canvas.height * pdfWidth) / canvas.width; 
                  const pageHeight = 295; 
                  let heightLeft = pdfHeight;
                  let position = 10; 
      
                  // Add the content to the PDF
                  pdf.addImage(imgData, 'PNG', 10, position, pdfWidth, pdfHeight);
                  heightLeft -= pageHeight;
      
                  // Add new pages if content is longer than one page
                  while (heightLeft > 0) {
                      pdf.addPage();
                      position = 0;
                      pdf.addImage(imgData, 'PNG', 10, position, pdfWidth, pdfHeight);
                      heightLeft -= pageHeight;
                  }
                  // Save the PDF
                  pdf.save('clients_table.pdf');
              });
          });
  // Excel // Excel
  function generateExcel() {
          const table = document.querySelector('.search-table');
          
          const wb = XLSX.utils.table_to_book(table, { sheet: "Clients Report" });
  
          // Generate Excel file and download it
          XLSX.writeFile(wb, "clients_report.xlsx");
      }
   
  document.addEventListener("DOMContentLoaded", () => {
    const selectAll = document.getElementById("contact-check-all");
    const checkboxes = document.querySelectorAll(".contact-chkbox");
    const deleteBtn = document.getElementById("deleteSelectedBtn");

    const toggleButton = () => {
      const selected = document.querySelectorAll(".contact-chkbox:checked").length;
      deleteBtn.style.display = selected > 0 ? "inline-flex" : "none";
    };

    if (selectAll) {
      selectAll.addEventListener("change", () => {
        checkboxes.forEach(cb => {
          if (cb.closest('tr').style.display !== 'none') {
            cb.checked = selectAll.checked;
          }
        });
        toggleButton();
      });
    }

    checkboxes.forEach(cb => cb.addEventListener("change", () => {
      const visibleCheckboxes = Array.from(checkboxes).filter(checkbox =>
        checkbox.closest('tr').style.display !== 'none'
      );
      const allChecked = visibleCheckboxes.length > 0 && visibleCheckboxes.every(cb => cb.checked);
      if (selectAll) selectAll.checked = allChecked;
      toggleButton();
    }));

    deleteBtn.addEventListener("click", async () => {
      const selectedIds = [...document.querySelectorAll(".contact-chkbox:checked")].map(cb => cb.value);
      if (selectedIds.length === 0) return alert("Please select at least one client to delete.");
      if (!confirm(`Delete ${selectedIds.length} selected client(s)?`)) return;

      try {
        const tableName = deleteBtn.dataset.table; // "clients"
        const res = await fetch(`/delete-selected/${tableName}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ selectedIds }),
        });

        const data = await res.json();
        if (data.success) {
          selectedIds.forEach(id => {
            const row = document.querySelector(`tr[data-user-id="${id}"]`);
            if (row) row.remove();
          });
          alert("Selected clients deleted successfully.");
          toggleButton();
        } else {
          alert("Error deleting clients: " + data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Something went wrong.");
      }
    });

    toggleButton();
  });
  
  // Table pagination
  document.addEventListener("DOMContentLoaded", () => {
    setTimeout(function() {
      const rowsPerPage = 10;
      let currentPage = 1;
      const tableRows = document.querySelectorAll('#paginatedTable tbody tr');
      const cardRows = document.querySelectorAll('.d-xl-none > .row > .col-12');
      const totalRows = tableRows.length > 0 ? tableRows.length : cardRows.length;
      const totalPages = Math.ceil(totalRows / rowsPerPage);

      function showPage(page) {
        currentPage = page;
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        tableRows.forEach((row, index) => {
          row.style.display = (index >= start && index < end) ? '' : 'none';
        });

        cardRows.forEach((card, index) => {
          card.style.display = (index >= start && index < end) ? '' : 'none';
        });

        document.getElementById('currentEntries').textContent = Math.min(end, totalRows);
        updatePagination();
      }

      function updatePagination() {
        const pagination = document.getElementById('pagination');
        if (!pagination) return;
        pagination.innerHTML = '';

        const prevLi = document.createElement('li');
        prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
        prevLi.innerHTML = `<a class="page-link" href="#"><i class="bi bi-chevron-left me-1"></i> Previous</a>`;
        prevLi.addEventListener('click', (e) => {
          e.preventDefault();
          if (currentPage > 1) showPage(currentPage - 1);
        });
        pagination.appendChild(prevLi);

        const nextLi = document.createElement('li');
        nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
        nextLi.innerHTML = `<a class="page-link" href="#">Next <i class="bi bi-chevron-right ms-1"></i></a>`;
        nextLi.addEventListener('click', (e) => {
          e.preventDefault();
          if (currentPage < totalPages) showPage(currentPage + 1);
        });
        pagination.appendChild(nextLi);
      }

      if (totalRows > 0) showPage(1);
    }, 100);
  });
  
  // Print single client
  function printTable(userId) {
    if (userId) {
        const userRow = document.querySelector(`tr[data-user-id="${userId}"]`);
        if (!userRow) return;

        let now = new Date();
        let formattedDate = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        let formattedTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        let userName = userRow.querySelector('.user-name') ? userRow.querySelector('.user-name').innerText : 'N/A';
        let userEmail = userRow.cells[2] ? userRow.cells[2].innerText : 'N/A';
        let brand = userRow.cells[3] ? userRow.cells[3].innerText : 'N/A';
        let status = userRow.querySelector('.status-select') ? userRow.querySelector('.status-select').value : 'N/A';

        const printWindow = window.open('', 'PrintWindow', 'height=600,width=800');
        printWindow.document.write(`
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                h1 { text-align: center; color: #333; }
                .date { display: flex; justify-content: space-between; margin: 20px; font-weight: bold; }
                .dates { display: flex; justify-content: space-between; margin: 20px; border-bottom: 3px double #ccc; padding-bottom: 10px; }
                .info-section { margin: 20px; display: flex; justify-content: space-around; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
                .info-section div { text-align: center; }
                .info-section h5 { font-weight: bold; margin-bottom: 10px; }
                .footer { margin-top: 100px; text-align: center; font-weight: bold; }
              </style>
            </head>
            <body>
              <h1>Client Details</h1>
              <div class="date">
                <p>Date: ${formattedDate}</p>
                <p>Time: ${formattedTime}</p>
              </div>
              <div class="date">
                <p>Name: ${userName}</p>
              </div>
              <div class="dates">
                <p>Email: ${userEmail}</p>
              </div>
              <div class="info-section">
                <div><h5>Brand</h5><p>${brand}</p></div>
                <div><h5>Status</h5><p>${status}</p></div>
              </div>
              <div class="footer">
                <p>Developed By ClickTake Technologies Â© 2025 DibNow</p>
              </div>
            </body>
          </html>
        `);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    } 
    else {
        // If no userId is provided, print the entire table
        const tableContent = document.querySelector('.table-responsive').innerHTML;

        const printWindow = window.open('sss', 'PrintTableWindow', 'width=800,height=600');

        printWindow.document.open();
        printWindow.document.write(`
            <html>
                <head>
                    <style>
                        /* Add styles for printing the entire table */
                        body {
                            font-family: Arial, sans-serif;
                            margin: 0;
                            padding: 0;
                        }
                        h2 {
                            text-align: center;
                            color: #333;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: left;
                        }
                        th {
                            background-color: #f2f2f2;
                            font-weight: bold;
                        }
                        td {
                            background-color: #fafafa;
                        }
                               .customer-footer {
                                margin-top: 745px;
                                text-align: center;
                                font-weight: bold;
                            }
                    </style>
                </head>
                <body>
                    <h2>Clients Report</h2>
                    ${tableContent}
                      <!-- Customer Details Footer -->
                        <div class="customer-footer">
                            <p>Developed By Clicktake Technologies Copy Right @ 2025</p>
                        </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }
}


  
  </script>

  
  
        <!--  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    
<!-- Template Javascript -->
<script src="js/main.js"></script>

</html>